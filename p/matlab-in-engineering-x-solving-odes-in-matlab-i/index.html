<!DOCTYPE html>
<html lang="en-us" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='All figures in this blog are embedded by Github Image Hosting Service. These figures may not be displayed on mobile devices.
This blog contains a lot of LaTeX code, please use Chrome for reading quality.
 Euler Method, ode1 If $y(t)$ is a differential function, then for $t_0$ in its domain, we have that
$$ y&#39;(t_0)\approx \frac{y(t_0&#43;h)-y(t_0)}{h} $$
and hence
$$ y(t_0&#43;h)\approx y(t_0)&#43;h\cdot y&#39;(t_0) $$
This is the basis for the Euler method.'><title>MATLAB in Engineering X (Solving ODEs in MATLAB i)</title>

<link rel='canonical' href='https://wanghaoming177.netlify.app/p/matlab-in-engineering-x-solving-odes-in-matlab-i/'>

<link rel="stylesheet" href="/scss/style.min.6cb794b99473add9625fc6fcb4fd8782c21b06365b632b8fbb1076efe11c688e.css"><meta property='og:title' content='MATLAB in Engineering X (Solving ODEs in MATLAB i)'>
<meta property='og:description' content='All figures in this blog are embedded by Github Image Hosting Service. These figures may not be displayed on mobile devices.
This blog contains a lot of LaTeX code, please use Chrome for reading quality.
 Euler Method, ode1 If $y(t)$ is a differential function, then for $t_0$ in its domain, we have that
$$ y&#39;(t_0)\approx \frac{y(t_0&#43;h)-y(t_0)}{h} $$
and hence
$$ y(t_0&#43;h)\approx y(t_0)&#43;h\cdot y&#39;(t_0) $$
This is the basis for the Euler method.'>
<meta property='og:url' content='https://wanghaoming177.netlify.app/p/matlab-in-engineering-x-solving-odes-in-matlab-i/'>
<meta property='og:site_name' content='Haoming Wang'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='MATLAB' /><meta property='article:published_time' content='2021-03-01T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2021-03-01T00:00:00&#43;00:00'/>
<meta name="twitter:title" content="MATLAB in Engineering X (Solving ODEs in MATLAB i)">
<meta name="twitter:description" content="All figures in this blog are embedded by Github Image Hosting Service. These figures may not be displayed on mobile devices.
This blog contains a lot of LaTeX code, please use Chrome for reading quality.
 Euler Method, ode1 If $y(t)$ is a differential function, then for $t_0$ in its domain, we have that
$$ y&#39;(t_0)\approx \frac{y(t_0&#43;h)-y(t_0)}{h} $$
and hence
$$ y(t_0&#43;h)\approx y(t_0)&#43;h\cdot y&#39;(t_0) $$
This is the basis for the Euler method.">
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            localStorage.setItem(colorSchemeKey, "dark");
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/IMG_0770_hu86b91b9497cdda82d5c488540c7342b2_101927_300x0_resize_q75_box.jpg" width="300"
                            height="273" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">üåè</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">Haoming Wang</a></h1>
            <h2 class="site-description">We choose to go to the moon in this decade and do the other things, not because they are easy, but because they are hard.</h2>
        </div>
    </header><ol class="social-menu">
            
                <li>
                    <a 
                        href='https://github.com/floating15'
                        target="_blank"
                        title="GitHub"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://www.linkedin.com/in/%E6%B5%A9%E9%93%AD-%E7%8E%8B-b0a164171/'
                        target="_blank"
                        title="Linkedin"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-linkedin" width="28" height="28" viewBox="0 0 24 24" stroke-width="1.5" stroke="#9e9e9e" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <rect x="4" y="4" width="16" height="16" rx="2" />
  <line x1="8" y1="11" x2="8" y2="16" />
  <line x1="8" y1="8" x2="8" y2="8.01" />
  <line x1="12" y1="16" x2="12" y2="11" />
  <path d="M16 16v-3a2 2 0 0 0 -4 0" />
</svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://follow.it/haoming-wang?action=followPub'
                        target="_blank"
                        title="r-mail"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-mailbox" width="28" height="28" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M10 21v-6.5a3.5 3.5 0 0 0 -7 0v6.5h18v-6a4 4 0 0 0 -4 -4h-10.5" />
  <path d="M12 11v-8h4l2 2l-2 2h-4" />
  <path d="M6 15h1" />
</svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://twitter.com'
                        target="_blank"
                        title="Twitter"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        

        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="#FF1C02" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        

        <li >
            <a href='/about/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="#35FF02" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>About</span>
            </a>
        </li>
        
        

        <li >
            <a href='/notes/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-math-function" width="28" height="28" viewBox="0 0 24 24" stroke-width="1.5" stroke="#02EAFF" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M14 10h1c1 0 1 1 2.016 3.527c.984 2.473 .984 3.473 1.984 3.473h1" />
  <path d="M13 17c1.5 0 3 -2 4 -3.5s2.5 -3.5 4 -3.5" />
  <path d="M3 19c0 1.5 .5 2 2 2s2 -4 3 -9s1.5 -9 3 -9s2 .5 2 2" />
  <line x1="5" y1="12" x2="11" y2="12" />
</svg>
                
                <span>Notes</span>
            </a>
        </li>
        
        

        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="#0223FF" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        

        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="#F402FF" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        

        <li >
            <a href='/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        

        <div class="menu-bottom-section">
            
            
        </div>
    </ol>
</aside>
<main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/sci_compute/" >
                Scientific Computing
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/matlab-in-engineering-x-solving-odes-in-matlab-i/">MATLAB in Engineering X (Solving ODEs in MATLAB i)</a>
        </h2>
    
        
    </div>

    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Mar 01, 2021</time>
            </div>
        

        
    </footer>
    

    
</div>
</header>

    <section class="article-content">
    
    
    <blockquote>
<p>All figures in this blog are embedded by Github Image Hosting Service. These figures may not be displayed on mobile devices.</p>
<p>This blog contains a lot of LaTeX code, please use Chrome for reading quality.</p>
</blockquote>
<h1 id="euler-method-ode1">Euler Method, <code>ode1</code></h1>
<p>If $y(t)$ is a differential function, then for $t_0$ in its domain, we have that</p>
<p>$$
y'(t_0)\approx \frac{y(t_0+h)-y(t_0)}{h}
$$</p>
<p>and hence</p>
<p>$$
y(t_0+h)\approx y(t_0)+h\cdot y'(t_0)
$$</p>
<p>This is the basis for the Euler method.</p>
<p>A differential equation is of the form:</p>
<p>$$
y' = f(t,y)
$$</p>
<p>and the task in general is to find the function $y$ whose derivative is equal to $f$ with an initial condition like</p>
<p>$$
y(t_0) =y_0
$$</p>
<p>Euler&rsquo;s method involves a sequence of points $t_n$ separated by a fixed step size $h$. And then $y_n$ is an approximation to the value of the solution at $t_n$.</p>
<p>$$
t_{n+1} = t_{n}+h
$$</p>
<p>$$
y_n = y(t_n)
$$</p>
<p>and the approximation comes from the slope of the secant. The ratio of the difference of the values of $y$ and to the step size $h$. The differential equation says that this ratio should be the value of the function $f$ at $t_n$.</p>
<p>$$
\frac{y(t_0+h)-y(t_0)}{h}\approx f(t_n, y(t_n))
$$</p>
<p>And if we rearrange this equation, we get <strong>Euler&rsquo;s method</strong>:</p>
<p>$$
y_{n+1} = y_{n} + h\cdot f(t_n, y_n)
$$</p>
<p>That $y_{n+1}$ is $y_n$ + $h$ times the function $f$ evaluated at $t_n$ and $y_n$. This is Euler&rsquo;s method (EM).</p>
<p>The MATLAB code to solve DEs by EM is like</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-matlab" data-lang="matlab"><span class="k">function</span><span class="w"> </span>yout <span class="p">=</span><span class="w"> </span><span class="nf">myode1</span><span class="p">(</span>F, t0, h, tfinal, y0<span class="p">)</span><span class="w">
</span><span class="w"></span><span class="c">% myode1 A simple ode solver</span>

<span class="n">y</span> <span class="p">=</span> <span class="n">y0</span><span class="p">;</span>
<span class="n">yout</span> <span class="p">=</span> <span class="n">y</span><span class="p">;</span>
<span class="k">for</span> <span class="n">t</span> <span class="p">=</span> <span class="n">t0</span><span class="p">:</span><span class="n">h</span><span class="p">:</span><span class="n">tfinal</span><span class="o">-</span><span class="n">h</span>
    <span class="n">s</span> <span class="p">=</span> <span class="n">F</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">y</span><span class="p">);</span>
    <span class="n">y</span> <span class="p">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span><span class="o">*</span><span class="n">s</span><span class="p">;</span>
    <span class="n">yout</span> <span class="p">=</span> <span class="p">[</span><span class="n">yout</span><span class="p">;</span> <span class="n">y</span><span class="p">];</span>
<span class="k">end</span>
</code></pre></td></tr></table>
</div>
</div><p>The output <code>yout</code> is a vector. Vector <code>yout</code> is the values of the solution at the points in the interval. For example, solve the DE:</p>
<pre tabindex="0"><code>y'=2y
y(0)=10
0&lt;=t&lt;=3
</code></pre><p>then</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-matlab" data-lang="matlab"><span class="o">&gt;&gt;</span> <span class="n">F</span> <span class="p">=</span> <span class="p">@(</span><span class="n">t</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="mi">2</span><span class="o">*</span><span class="n">y</span><span class="p">;</span>
<span class="o">&gt;&gt;</span> <span class="n">yout</span> <span class="p">=</span> <span class="n">myode1</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
<span class="o">&gt;&gt;</span> <span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">:</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span><span class="o">&#39;</span><span class="p">,</span> <span class="n">yout</span><span class="p">,</span> <span class="s">&#39;linewidth&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p><img src="https://raw.githubusercontent.com/floating15/img/main/202205271522180.png"
	
	
	
	loading="lazy"
	
	
></p>
<h1 id="midpoint-method-ode2">Midpoint Method, <code>ode2</code></h1>
<p>The cost of a numerical method for solving ordinary differential equations is measured by the number of times it evaluates the function $f$ per step. Euler&rsquo;s method evaluates $f$ once per step (that is why the Euler&rsquo;s method solver built-in function of MATLAB is called <code>ode1()</code>).</p>
<p>Here&rsquo;s a new method that evaluates it twice per step. If $f$ is evaluated once at the beginning of the step to give a slope $s_1$,</p>
<p>$$
s_1=f(t_n,y_n),
$$</p>
<p>and then $s_1$ is used to take Euler&rsquo;s step halfway across the interval, the function is evaluated in the middle of the interval to give the slope $s_2$.</p>
<p>$$
s_2 = f(t_n+h/2, y_n+s_1\cdot h/2)
$$</p>
<p>And then $s_2$ is used to take the step. For obvious reasons, this is called the midpoint method.</p>
<p>$$
y_{n+1} = y_{n} + h\cdot s_2
$$</p>
<p>The MATLAB code to solve DEs by midpoint method is like</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-matlab" data-lang="matlab"><span class="k">function</span><span class="w"> </span>yout <span class="p">=</span><span class="w"> </span><span class="nf">myode2</span><span class="p">(</span>F, t0, h, tf, y0<span class="p">)</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="n">y</span> <span class="p">=</span> <span class="n">y0</span><span class="p">;</span>
<span class="n">yout</span> <span class="p">=</span> <span class="n">y</span><span class="p">;</span>
<span class="k">for</span> <span class="n">t</span> <span class="p">=</span> <span class="n">t0</span><span class="p">:</span> <span class="n">h</span><span class="p">:</span> <span class="n">tf</span> <span class="o">-</span> <span class="n">h</span>
    <span class="n">s1</span> <span class="p">=</span> <span class="n">F</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">y</span><span class="p">);</span>
    <span class="n">s2</span> <span class="p">=</span> <span class="n">F</span><span class="p">(</span><span class="n">t</span><span class="o">+</span><span class="n">h</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="n">s1</span><span class="o">*</span><span class="n">h</span><span class="o">/</span><span class="mi">2</span><span class="p">);</span>
    <span class="n">y</span> <span class="p">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span><span class="o">*</span><span class="n">s2</span><span class="p">;</span>
    <span class="n">yout</span> <span class="p">=</span> <span class="p">[</span><span class="n">yout</span><span class="p">;</span> <span class="n">y</span><span class="p">];</span>
<span class="k">end</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>Ex</strong>: solve the de:</p>
<pre tabindex="0"><code>y' = \sqrt{1-y^2}
y(0) = 0
0&lt;= t &lt;= \pi/2
</code></pre><p>solve:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-matlab" data-lang="matlab"><span class="o">&gt;&gt;</span> <span class="n">F</span> <span class="p">=</span> <span class="p">@(</span><span class="n">t</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">y</span>^<span class="mi">2</span><span class="p">)</span>^<span class="mf">0.5</span><span class="p">;</span>
<span class="o">&gt;&gt;</span> <span class="n">y0</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="o">&gt;&gt;</span> <span class="n">yout</span> <span class="p">=</span> <span class="n">myode2</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="nb">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">y0</span><span class="p">);</span>
<span class="o">&gt;&gt;</span> <span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">:</span><span class="mf">0.05</span><span class="p">:</span><span class="nb">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">]</span><span class="o">&#39;</span><span class="p">,</span> <span class="n">yout</span><span class="p">,</span> <span class="s">&#39;linewidth&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p><img src="https://raw.githubusercontent.com/floating15/img/main/202205271520295.png"
	
	
	
	loading="lazy"
	
	
></p>
<h1 id="classical-runge-kutta-ode4">Classical Runge-Kutta, <code>ode4</code></h1>
<p>RK evaluate the function four times per step, first in the beginning of the interval. And then use that to step into the middle of the interval, to get $s_2$. Then use $s_2$ to step into the middle of the interval again. And evaluate the function there again to get $s_3$. And then use $s_3$ to step clear across the interval, and get $s_4$.</p>
<p>$$
s_{1} = f(t_{n}, y_{n})
$$</p>
<p>$$
s_{2} = f(t_{n}+h/2, y_{n}+s_{1}\cdot h/2)
$$</p>
<p>$$
s_{3} = f(t_{n}+h/2, y_{n}+s_{2}\cdot h/2)
$$</p>
<p>$$
s_{4} = f(t_{n}+h, y_{n}+s_{3}\cdot h)
$$</p>
<p>And finally take a combination of those four slopes, weighting the two in the middle more heavily,</p>
<p>$$
y_{n+1} = y_{n} + h\cdot \frac{s_1+2s_2+2s_3+s_4}{6}
$$</p>
<p>This&rsquo;s the classical Runge-Kutta method. The MATLAB code is as follow:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-matlab" data-lang="matlab"><span class="k">function</span><span class="w"> </span>yout <span class="p">=</span><span class="w"> </span><span class="nf">myode4</span><span class="p">(</span>F, t0, h, tf, y0<span class="p">)</span><span class="w">
</span><span class="w"></span><span class="n">y</span> <span class="p">=</span> <span class="n">y0</span><span class="p">;</span>
<span class="n">yout</span> <span class="p">=</span> <span class="n">y</span><span class="p">;</span>
<span class="k">for</span> <span class="n">t</span> <span class="p">=</span> <span class="n">t0</span><span class="p">:</span> <span class="n">h</span><span class="p">:</span> <span class="n">tf</span><span class="o">-</span><span class="n">h</span>
    <span class="n">s1</span> <span class="p">=</span> <span class="n">F</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">y</span><span class="p">);</span>
    <span class="n">s2</span> <span class="p">=</span> <span class="n">F</span><span class="p">(</span><span class="n">t</span><span class="o">+</span><span class="n">h</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="n">s1</span><span class="o">*</span><span class="n">h</span><span class="o">/</span><span class="mi">2</span><span class="p">);</span>
    <span class="n">s3</span> <span class="p">=</span> <span class="n">F</span><span class="p">(</span><span class="n">t</span><span class="o">+</span><span class="n">h</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="n">s2</span><span class="o">*</span><span class="n">h</span><span class="o">/</span><span class="mi">2</span><span class="p">);</span>
    <span class="n">s4</span> <span class="p">=</span> <span class="n">F</span><span class="p">(</span><span class="n">t</span><span class="o">+</span><span class="n">h</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="n">s3</span><span class="o">*</span><span class="n">h</span><span class="p">);</span>
    <span class="n">y</span> <span class="p">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span> <span class="o">*</span> <span class="p">(</span><span class="n">s1</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">s2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">s3</span> <span class="o">+</span> <span class="n">s4</span><span class="p">)</span><span class="o">/</span><span class="mi">6</span><span class="p">;</span>
    <span class="n">yout</span> <span class="p">=</span> <span class="p">[</span><span class="n">yout</span><span class="p">;</span> <span class="n">y</span><span class="p">];</span>
<span class="k">end</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>Ex:</strong> solve the eq:</p>
<pre tabindex="0"><code>y' = y^2-y^3
y(0) = 0.01
0&lt;= t &lt;=2/y0
</code></pre><p>solve:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-matlab" data-lang="matlab"><span class="o">&gt;&gt;</span> <span class="n">F</span> <span class="p">=</span> <span class="p">@(</span><span class="n">t</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="n">y</span>^<span class="mi">2</span><span class="o">-</span><span class="n">y</span>^<span class="mi">3</span><span class="p">;</span>
<span class="o">&gt;&gt;</span> <span class="n">t0</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">y0</span> <span class="p">=</span> <span class="mf">0.01</span><span class="p">;</span> <span class="n">tf</span> <span class="p">=</span> <span class="mi">2</span><span class="o">/</span><span class="n">y0</span><span class="p">;</span> <span class="n">h</span> <span class="p">=</span> <span class="n">tf</span><span class="o">/</span><span class="mi">500</span><span class="p">;</span>
<span class="o">&gt;&gt;</span> <span class="n">yo</span> <span class="p">=</span> <span class="n">myode4</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">tf</span><span class="p">,</span> <span class="n">y0</span><span class="p">);</span>
<span class="o">&gt;&gt;</span> <span class="n">plot</span><span class="p">([</span><span class="n">t0</span><span class="p">:</span><span class="n">h</span><span class="p">:</span><span class="n">tf</span><span class="p">]</span><span class="o">&#39;</span><span class="p">,</span> <span class="n">yo</span><span class="p">,</span> <span class="s">&#39;linewidth&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="o">&gt;&gt;</span> <span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;t&#39;</span><span class="p">);</span> <span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;y(t)&#39;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p><img src="https://raw.githubusercontent.com/floating15/img/main/202205271603456.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>To obtain the time when $y$ reach 0.9, we have</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-matlab" data-lang="matlab"><span class="o">&gt;&gt;</span> <span class="n">t</span> <span class="p">=</span> <span class="p">[</span><span class="n">t0</span><span class="p">:</span><span class="n">h</span><span class="p">:</span><span class="n">tf</span><span class="p">]</span><span class="o">&#39;</span><span class="p">;</span> <span class="n">tmin</span> <span class="p">=</span> <span class="n">min</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="n">yo</span><span class="o">&gt;</span><span class="p">=</span><span class="mf">0.9</span><span class="p">))</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>tmin =

   106
</code></pre><p>and we can explore the accuracy difference between <code>ode1</code>, <code>ode2</code> and <code>ode4</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-matlab" data-lang="matlab"><span class="o">&gt;&gt;</span> <span class="n">yo1</span> <span class="p">=</span> <span class="n">myode1</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">tf</span><span class="p">,</span> <span class="n">y0</span><span class="p">);</span>
<span class="o">&gt;&gt;</span> <span class="n">yo2</span> <span class="p">=</span> <span class="n">myode2</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">tf</span><span class="p">,</span> <span class="n">y0</span><span class="p">);</span>
<span class="o">&gt;&gt;</span> <span class="n">yo4</span> <span class="p">=</span> <span class="n">myode4</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">tf</span><span class="p">,</span> <span class="n">y0</span><span class="p">);</span>
<span class="o">&gt;&gt;</span> <span class="n">plot</span><span class="p">([</span><span class="n">t0</span><span class="p">:</span><span class="n">h</span><span class="p">:</span><span class="n">tf</span><span class="p">]</span><span class="o">&#39;</span><span class="p">,</span> <span class="n">yo1</span><span class="p">,</span> <span class="p">[</span><span class="n">t0</span><span class="p">:</span><span class="n">h</span><span class="p">:</span><span class="n">tf</span><span class="p">]</span><span class="o">&#39;</span><span class="p">,</span> <span class="n">yo2</span><span class="p">,</span> <span class="p">[</span><span class="n">t0</span><span class="p">:</span><span class="n">h</span><span class="p">:</span><span class="n">tf</span><span class="p">]</span><span class="o">&#39;</span><span class="p">,</span> <span class="n">yo4</span><span class="p">,</span> <span class="s">&#39;linewidth&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="o">&gt;&gt;</span> <span class="n">legend</span><span class="p">(</span><span class="s">&#39;ode1&#39;</span><span class="p">,</span> <span class="s">&#39;ode2&#39;</span><span class="p">,</span> <span class="s">&#39;ode4&#39;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p><img src="https://raw.githubusercontent.com/floating15/img/main/202205271613429.png"
	
	
	
	loading="lazy"
	
	
></p>
<blockquote>
<p>If the differential equation does not involve $y$, then this solution is just an integral. And the Runge-Kutta method becomes a classic method of numerical integration.</p>
</blockquote>
<h1 id="order">Order</h1>
<p>A Very important property of a numerical method is its order. The accuracy of the method is proportional to a power of the step size. And that power is called the order.</p>
<p>If $h$ is the step size and $p$ is the order, then the error made in one step is proportional to $h^{p+1}$. And the error made in traversing an entire interval is proportional to $h^p$.</p>
<p>So this means, if you&rsquo;re using a method of order $p$, and cut the step size in half, you can expect the overall error to be reduced by a factor of 2 to the $p$. The order of a numerical
method is determined by analysis involving Taylor series during the derivation of the method.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-matlab" data-lang="matlab"><span class="k">function</span><span class="w"> </span>p <span class="p">=</span><span class="w"> </span><span class="nf">orderx</span><span class="p">(</span>odex<span class="p">)</span><span class="w">
</span><span class="w"></span><span class="n">ve</span> <span class="p">=</span> <span class="mf">0.5</span><span class="p">;</span>
<span class="n">F</span>  <span class="p">=</span> <span class="p">@(</span><span class="n">t</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">t</span><span class="p">)</span>^<span class="mi">2</span><span class="p">;</span>
<span class="n">t0</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">tf</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">y0</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">h1</span> <span class="p">=</span> <span class="mf">0.1</span><span class="p">;</span> <span class="n">h2</span> <span class="p">=</span> <span class="n">h1</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
<span class="n">yout</span> <span class="p">=</span> <span class="n">odex</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">h1</span><span class="p">,</span> <span class="n">tf</span><span class="p">,</span> <span class="n">y0</span><span class="p">);</span>
<span class="n">v1</span> <span class="p">=</span> <span class="n">yout</span><span class="p">(</span><span class="k">end</span><span class="p">)</span>
<span class="n">yout</span> <span class="p">=</span> <span class="n">odex</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">h2</span><span class="p">,</span> <span class="n">tf</span><span class="p">,</span> <span class="n">y0</span><span class="p">);</span>
<span class="n">v2</span> <span class="p">=</span> <span class="n">yout</span><span class="p">(</span><span class="k">end</span><span class="p">)</span>
<span class="n">ratio</span> <span class="p">=</span> <span class="p">(</span><span class="n">v1</span><span class="o">-</span><span class="n">ve</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">v2</span><span class="o">-</span><span class="n">ve</span><span class="p">)</span>
<span class="n">p</span> <span class="p">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">ratio</span>^<span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">));</span>
</code></pre></td></tr></table>
</div>
</div><p>The input of the above program is the handle of an ODE solver function. And then it&rsquo;s going to do a numerical integration of an ordinary differential equation, just involving $t$:</p>
<p>$$
\int^{1}_{0}\frac{1}{(1+t)}dt = \frac{1}{2},
$$</p>
<p>We know the exact answer is 1/2. So we integrate that differential equation twice, once with a step size of <code>h1=0.1</code>, and then with a step size of one half <code>h2=h1/2</code>. We integrate the differential equation, take the final value of <code>y</code> for each of those two integrations (which represents $y(1)$), compare their errors <code>v1-ve</code> and <code>v2-ve</code> and take the ratio of those two values. That shows how much the error is decreased when we cut the step size in half.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-matlab" data-lang="matlab"><span class="o">&gt;&gt;</span> <span class="n">orderx</span><span class="p">(@</span><span class="n">myode1</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>v1 =
    0.5390

v2 =
    0.5191

ratio =
    2.0380

ans =
     1
</code></pre><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-matlab" data-lang="matlab"><span class="o">&gt;&gt;</span> <span class="n">orderx</span><span class="p">(@</span><span class="n">myode2</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>v1 =
    0.4993

v2 =
    0.4998

ratio =
    3.9885

ans =
     2
</code></pre><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-matlab" data-lang="matlab"><span class="o">&gt;&gt;</span> <span class="n">orderx</span><span class="p">(@</span><span class="n">myode4</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>v1 =
    0.5000

v2 =
    0.5000

ratio =
   15.8920

ans =
     4
</code></pre><p>This brings us to the naming conventions in the functions in the MATLAB ODE suite. All the functions have names that are variations on the theme <code>ODEpq</code>. That means that the method <code>ODEpq</code> uses methods of order <code>p</code> and <code>q</code>.</p>
<h1 id="estimating-error-ode23">Estimating Error, <code>ode23</code></h1>
<p><code>ode23()</code> can estimate error and provide automatic step size control. Thus We don&rsquo;t need to specify the step size <code>h</code>. We specify an accuracy we want. And the methods estimate the errors as they go along and adjust the step size accordingly.</p>
<ul>
<li>
<p><code>[t,y] = ode23(odefun,tspan,y0)</code>, where <code>tspan = [t0 tf]</code>, integrates the system of differential equations <code>y'=f(t,y)</code> from <code>t0</code> to <code>tf</code> with initial conditions <code>y0</code>. Each row in the solution array <code>y</code> corresponds to a value returned in column vector <code>t</code>.</p>
</li>
<li>
<p><code>[t,y] = ode23(odefun,tspan,y0,options)</code> also uses the integration settings defined by <code>options</code>, which is an argument created using the <code>odeset</code> function. For example, use the <code>AbsTol</code> and <code>RelTol</code> options to specify absolute and relative error tolerances, or the <code>Mass</code> option to provide a mass matrix.</p>
</li>
</ul>
<p>Now let&rsquo;s try something to see the automatic error-controlled step size choice in action. Set <code>a = .25</code>. and then set <code>y0 = 15.9</code>. (If I set <code>y0=16</code>, <code>y(t)</code> would be singular at <code>x=.25</code>). Now integrate the de with the <code>ode23</code> on the interval from 0 to 1 starting at <code>y0</code>, and saving the results in <code>t</code> and <code>y</code>, and then plotting them.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-matlab" data-lang="matlab"><span class="c">%% ode23</span>

<span class="n">a</span> <span class="p">=</span> <span class="p">.</span><span class="mi">25</span><span class="p">;</span> 
<span class="n">y0</span> <span class="p">=</span> <span class="mf">15.9</span><span class="p">;</span>
<span class="n">F</span> <span class="p">=</span> <span class="p">@(</span><span class="n">t</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="n">t</span><span class="p">)</span><span class="o">*</span><span class="n">y</span>^<span class="mi">2</span><span class="p">;</span>
<span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="p">=</span> <span class="n">ode23</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">y0</span><span class="p">);</span>
<span class="n">h</span> <span class="p">=</span> <span class="n">diff</span><span class="p">(</span><span class="n">t</span><span class="p">);</span>

<span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span> 
<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span><span class="s">&#39;-&#39;</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="s">&#39;LineWidth&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;markersize&#39;</span><span class="p">,</span> <span class="mi">24</span><span class="p">);</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;time: t&#39;</span><span class="p">);</span> <span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;y(t)&#39;</span><span class="p">);</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="k">end</span><span class="p">),</span> <span class="n">h</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="s">&#39;MarkerSize&#39;</span><span class="p">,</span> <span class="mi">24</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;time: t&#39;</span><span class="p">);</span> <span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;step size: h&#39;</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p><img src="https://raw.githubusercontent.com/floating15/img/main/202205271717842.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>So there is a near singularity at <code>a</code>. It nearly blows up. And then it settles back down. So the points are bunched together as they go up to the singularity and come back down, but then get farther apart as the solution settles down. And the ODE solver is able to take bigger steps. In the right figure, we can see that a small step size was taken near the almost singularity at that 0.25. And then as we get towards the end of the interval, a larger step size is taken. This&rsquo;s the automatic step size choice of <code>ode23</code>.</p>
<p>All MATLAB¬Æ ODE solvers can solve systems of equations of the form <code>y'=f(t,y)</code>, or problems that involve a mass matrix, <code>M(t,y)y'=f(t,y)</code>. The solvers all use similar syntaxes.</p>
<p>The <code>ode23s</code> solver only can solve problems with a mass matrix if the mass matrix is constant. <code>ode15s</code> and <code>ode23t</code> can solve problems with a mass matrix that is singular, known as differential-algebraic equations (DAEs).</p>
<p>For example, The van der Pol equation is a second-order ODE:</p>
<p>$$
y'' - \mu(1-y^{2})y'+y=0,
$$</p>
<p>where $\mu&gt;0$ is a scalar parameter. Rewrite this equation as a system of first-order ODEs by making the substitution $y'=:y_{1}'=y_{2}$, The resulting system of first-order ODEs is</p>
<p>$$
y_{1}' = y_{2}
$$</p>
<p>$$
y'<em>{2} = \mu(1-y</em>{1}^{2})y_{2}-y_{1}
$$</p>
<p>and write the ODEs with $\mu=1$ as <code>.m</code> file, The variables $y_1$ and $y_2$ are the entries <code>y(1)</code> and <code>y(2)</code> of a two-element vector <code>y</code>, and <code>vdp1()</code> returns the corresponding two-element vector <code>dydt</code> that contains $y'<em>{1}$ and $y'</em>{2}$:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-matlab" data-lang="matlab"><span class="k">function</span><span class="w"> </span>dydt <span class="p">=</span><span class="w"> </span><span class="nf">vdp1</span><span class="p">(</span>t,y<span class="p">)</span><span class="w">
</span><span class="w">	</span><span class="n">dydt</span> <span class="p">=</span> <span class="p">[</span><span class="n">y</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">y</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>^<span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">y</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">y</span><span class="p">(</span><span class="mi">1</span><span class="p">)];</span>
</code></pre></td></tr></table>
</div>
</div><p>Solve the ODE using the <code>ode23</code> function on the time interval <code>[0 20]</code> with initial values <code>[2 0]</code>. The resulting output is a column vector of time points <code>t</code> and a solution array <code>y</code>. Each row in <code>y</code> corresponds to a time returned in the corresponding row of <code>t</code>. The first column of <code>y</code> corresponds to $y_1$, and the second column corresponds to $y_2$:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-matlab" data-lang="matlab"><span class="c">%% ode23</span>

<span class="n">clf</span><span class="p">;</span><span class="n">clear</span><span class="p">;</span>
<span class="p">[</span><span class="n">t</span><span class="p">,</span><span class="n">y</span><span class="p">]</span> <span class="p">=</span> <span class="n">ode23</span><span class="p">(@</span><span class="n">vdp1</span><span class="p">,[</span><span class="mi">0</span> <span class="mi">20</span><span class="p">],[</span><span class="mi">2</span><span class="p">;</span> <span class="mi">0</span><span class="p">]);</span>
<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">y</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span><span class="s">&#39;-o&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">y</span><span class="p">(:,</span><span class="mi">2</span><span class="p">),</span><span class="s">&#39;-o&#39;</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s">&#39;Solution of van der Pol Equation (\mu = 1) with ODE23&#39;</span><span class="p">);</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Time t&#39;</span><span class="p">);</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;Solution y&#39;</span><span class="p">);</span>
<span class="n">legend</span><span class="p">(</span><span class="s">&#39;y_1&#39;</span><span class="p">,</span><span class="s">&#39;y_2&#39;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p><img src="https://raw.githubusercontent.com/floating15/img/main/202205271739475.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>We now use <code>ode23</code> to solve Lorenz equation:</p>
<p>$$
x' = -sx+sy
$$</p>
<p>$$
y' = -xz + rx -y
$$</p>
<p>$$
z'=xy-bz
$$</p>
<p>with the parameters $s=10, r=28, b=8/3$. First, let&rsquo;s define the system of odes:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-matlab" data-lang="matlab"><span class="k">function</span><span class="w"> </span>z <span class="p">=</span><span class="w"> </span><span class="nf">ydot</span><span class="p">(</span>t,y<span class="p">)</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="n">s</span> <span class="p">=</span> <span class="mi">10</span><span class="p">;</span> <span class="n">r</span> <span class="p">=</span> <span class="mi">28</span><span class="p">;</span> <span class="n">b</span> <span class="p">=</span> <span class="mi">8</span><span class="o">/</span><span class="mi">3</span><span class="p">;</span>
<span class="n">z</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="o">-</span><span class="n">s</span><span class="o">*</span><span class="n">y</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">s</span><span class="o">*</span><span class="n">y</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="n">z</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="o">-</span><span class="n">y</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">y</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">r</span><span class="o">*</span><span class="n">y</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">y</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="n">z</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="p">=</span> <span class="n">y</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">y</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">b</span><span class="o">*</span><span class="n">y</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>then solve and plot</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-matlab" data-lang="matlab"><span class="o">&gt;&gt;</span> <span class="p">[</span><span class="n">t</span> <span class="n">z</span><span class="p">]</span> <span class="p">=</span> <span class="n">ode23</span><span class="p">(@</span><span class="n">ydot</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">500</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">]);</span>
<span class="o">&gt;&gt;</span> <span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span> <span class="n">plot</span><span class="p">(</span><span class="n">z</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span> <span class="n">z</span><span class="p">(:,</span><span class="mi">3</span><span class="p">));</span> <span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">);</span> <span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;z&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;</span> <span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span> <span class="n">plot</span><span class="p">(</span><span class="n">z</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span> <span class="n">z</span><span class="p">(:,</span><span class="mi">2</span><span class="p">),</span> <span class="s">&#39;r&#39;</span><span class="p">);</span> <span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">);</span> <span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;y&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;</span> <span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span> <span class="n">plot</span><span class="p">(</span><span class="n">z</span><span class="p">(:,</span><span class="mi">2</span><span class="p">),</span> <span class="n">z</span><span class="p">(:,</span><span class="mi">3</span><span class="p">),</span> <span class="s">&#39;g&#39;</span><span class="p">);</span> <span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;y&#39;</span><span class="p">);</span> <span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;z&#39;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p><img src="https://raw.githubusercontent.com/floating15/img/main/202205271815500.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>and</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-matlab" data-lang="matlab"><span class="o">&gt;&gt;</span> <span class="n">plot3</span><span class="p">(</span><span class="n">z</span><span class="p">(:,</span><span class="mi">1</span><span class="p">),</span> <span class="n">z</span><span class="p">(:,</span><span class="mi">2</span><span class="p">),</span> <span class="n">z</span><span class="p">(:,</span><span class="mi">3</span><span class="p">));</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">);</span> <span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;y&#39;</span><span class="p">);</span> <span class="n">zlabel</span><span class="p">(</span><span class="s">&#39;z&#39;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p><img src="https://raw.githubusercontent.com/floating15/img/main/202205271823142.png"
	
	
	
	loading="lazy"
	
	
></p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/matlab/">MATLAB</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
        <link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css"integrity="sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn"crossorigin="anonymous"
            ><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js"integrity="sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8"crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js"integrity="sha384-vZTG03m&#43;2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl"crossorigin="anonymous"
                defer
                >
            </script><script>
    window.addEventListener("DOMContentLoaded", () => {
        renderMathInElement(document.querySelector(`.article-content`), {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true }
            ]
        });})
</script>
    
</article>

    

    

<aside class="related-contents--wrapper">
    <h2 class="section-title">Related contents</h2>
    <div class="related-contents">
        <div class="flex article-list--tile">
            
                
<article class="">
    <a href="/p/matlab-in-engineering-ix-preconditioning-conjugate-gradient/">
        
        

        <div class="article-details">
            <h2 class="article-title">MATLAB in Engineering IX (Preconditioning Conjugate Gradient)</h2>
        </div>
    </a>
</article>
            
                
<article class="">
    <a href="/p/matlab-in-engineering-viii-matrix-decomposition/">
        
        

        <div class="article-details">
            <h2 class="article-title">MATLAB in Engineering VIII (Matrix Decomposition)</h2>
        </div>
    </a>
</article>
            
                
<article class="">
    <a href="/p/matlab-in-engineering-vii-symbolic-calculation-root-finding/">
        
        

        <div class="article-details">
            <h2 class="article-title">MATLAB in Engineering VII (Symbolic Calculation &amp; Root Finding)</h2>
        </div>
    </a>
</article>
            
                
<article class="">
    <a href="/p/matlab-in-engineering-vi-differentiation-integration/">
        
        

        <div class="article-details">
            <h2 class="article-title">MATLAB in Engineering VI (Differentiation &amp; Integration)</h2>
        </div>
    </a>
</article>
            
                
<article class="">
    <a href="/p/matlab-in-engineering-v-advanced-plotting/">
        
        

        <div class="article-details">
            <h2 class="article-title">MATLAB in Engineering V (Advanced Plotting)</h2>
        </div>
    </a>
</article>
            
        </div>
    </div>
</aside>

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2020 - 
        
        2022 Haoming Wang
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.11.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>

</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css"integrity="sha256-c0uckgykQ9v5k&#43;IqViZOZKc47Jn7KQil4/MP3ySA3F8="crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css"integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE="crossorigin="anonymous"
            >

            </main>
    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">Table of contents</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#euler-method-ode1">Euler Method, <code>ode1</code></a></li>
    <li><a href="#midpoint-method-ode2">Midpoint Method, <code>ode2</code></a></li>
    <li><a href="#classical-runge-kutta-ode4">Classical Runge-Kutta, <code>ode4</code></a></li>
    <li><a href="#order">Order</a></li>
    <li><a href="#estimating-error-ode23">Estimating Error, <code>ode23</code></a></li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js"integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

<script
    src="https://cdn.jsdelivr.net/gh/zhixuan2333/gh-blog@v0.1.0/js/ribbon.min.js"
    integrity="sha384-UEK8ZiP3VgFNP8KnKMKDmd4pAUAOJ59Y2Jo3ED2Z5qKQf6HLHovMxq7Beb9CLPUe"
    crossorigin="anonymous"
    size="300"
    alpha="0.6"
    zindex="-1"
    defer
></script>


    </body>
</html>
