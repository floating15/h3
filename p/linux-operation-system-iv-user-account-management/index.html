<!DOCTYPE html>
<html lang="en-us" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='All figures in this blog are embedded by Github Image Hosting Service. These figures may not be displayed on mobile devices.
All operations in this series of blogs (Linux Operation System) are done in AWS Elastic Compute Cloud (EC2).
 passwd, shadow and group file /etc/passwd The /etc/passwd file contains basic information about each user account on the system. Each line of the file represents a single account of type, normal user or system user and there are 7 fields on each line.'><title>Linux Operation System IV (User Account Management)</title>

<link rel='canonical' href='https://wanghaoming177.netlify.app/p/linux-operation-system-iv-user-account-management/'>

<link rel="stylesheet" href="/scss/style.min.6cb794b99473add9625fc6fcb4fd8782c21b06365b632b8fbb1076efe11c688e.css"><meta property='og:title' content='Linux Operation System IV (User Account Management)'>
<meta property='og:description' content='All figures in this blog are embedded by Github Image Hosting Service. These figures may not be displayed on mobile devices.
All operations in this series of blogs (Linux Operation System) are done in AWS Elastic Compute Cloud (EC2).
 passwd, shadow and group file /etc/passwd The /etc/passwd file contains basic information about each user account on the system. Each line of the file represents a single account of type, normal user or system user and there are 7 fields on each line.'>
<meta property='og:url' content='https://wanghaoming177.netlify.app/p/linux-operation-system-iv-user-account-management/'>
<meta property='og:site_name' content='Haoming Wang'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:published_time' content='2021-05-15T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2021-05-15T00:00:00&#43;00:00'/>
<meta name="twitter:title" content="Linux Operation System IV (User Account Management)">
<meta name="twitter:description" content="All figures in this blog are embedded by Github Image Hosting Service. These figures may not be displayed on mobile devices.
All operations in this series of blogs (Linux Operation System) are done in AWS Elastic Compute Cloud (EC2).
 passwd, shadow and group file /etc/passwd The /etc/passwd file contains basic information about each user account on the system. Each line of the file represents a single account of type, normal user or system user and there are 7 fields on each line.">
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            localStorage.setItem(colorSchemeKey, "dark");
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/IMG_0770_hu86b91b9497cdda82d5c488540c7342b2_101927_300x0_resize_q75_box.jpg" width="300"
                            height="273" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">üåè</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">Haoming Wang</a></h1>
            <h2 class="site-description">We choose to go to the moon in this decade and do the other things, not because they are easy, but because they are hard.</h2>
        </div>
    </header><ol class="social-menu">
            
                <li>
                    <a 
                        href='https://github.com/floating15'
                        target="_blank"
                        title="GitHub"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://www.linkedin.com/in/%E6%B5%A9%E9%93%AD-%E7%8E%8B-b0a164171/'
                        target="_blank"
                        title="Linkedin"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-linkedin" width="28" height="28" viewBox="0 0 24 24" stroke-width="1.5" stroke="#9e9e9e" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <rect x="4" y="4" width="16" height="16" rx="2" />
  <line x1="8" y1="11" x2="8" y2="16" />
  <line x1="8" y1="8" x2="8" y2="8.01" />
  <line x1="12" y1="16" x2="12" y2="11" />
  <path d="M16 16v-3a2 2 0 0 0 -4 0" />
</svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://follow.it/haoming-wang?action=followPub'
                        target="_blank"
                        title="r-mail"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-mailbox" width="28" height="28" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M10 21v-6.5a3.5 3.5 0 0 0 -7 0v6.5h18v-6a4 4 0 0 0 -4 -4h-10.5" />
  <path d="M12 11v-8h4l2 2l-2 2h-4" />
  <path d="M6 15h1" />
</svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://twitter.com'
                        target="_blank"
                        title="Twitter"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        

        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="#FF1C02" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        

        <li >
            <a href='/about/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="#35FF02" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>About</span>
            </a>
        </li>
        
        

        <li >
            <a href='/notes/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-math-function" width="28" height="28" viewBox="0 0 24 24" stroke-width="1.5" stroke="#02EAFF" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M14 10h1c1 0 1 1 2.016 3.527c.984 2.473 .984 3.473 1.984 3.473h1" />
  <path d="M13 17c1.5 0 3 -2 4 -3.5s2.5 -3.5 4 -3.5" />
  <path d="M3 19c0 1.5 .5 2 2 2s2 -4 3 -9s1.5 -9 3 -9s2 .5 2 2" />
  <line x1="5" y1="12" x2="11" y2="12" />
</svg>
                
                <span>Notes</span>
            </a>
        </li>
        
        

        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="#0223FF" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        

        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="#F402FF" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        

        <li >
            <a href='/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        

        <div class="menu-bottom-section">
            
            
        </div>
    </ol>
</aside>
<main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/linux/" >
                Linux
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/linux-operation-system-iv-user-account-management/">Linux Operation System IV (User Account Management)</a>
        </h2>
    
        
    </div>

    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">May 15, 2021</time>
            </div>
        

        
    </footer>
    

    
</div>
</header>

    <section class="article-content">
    
    
    <blockquote>
<p>All figures in this blog are embedded by Github Image Hosting Service. These figures may not be displayed on mobile devices.</p>
<p>All operations in this series of blogs (Linux Operation System) are done in AWS Elastic Compute Cloud (EC2).</p>
</blockquote>
<h1 id="passwd-shadow-and-group-file"><code>passwd</code>, <code>shadow</code> and <code>group</code> file</h1>
<h2 id="etcpasswd"><code>/etc/passwd</code></h2>
<p>The <code>/etc/passwd</code> file contains basic information about each user account on the system. Each line of the file represents a single account of type, normal user or system user and there are 7 fields on each line.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">ubuntu@ip-172-31-87-26:~$ cat /etc/passwd <span class="p">|</span> tail -n <span class="m">5</span>
pollinate:x:111:1::/var/cache/pollinate:/bin/false
ec2-instance-connect:x:112:65534::/nonexistent:/usr/sbin/nologin
systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin
ubuntu:x:1000:1000:Ubuntu:/home/ubuntu:/bin/bash
lxd:x:998:100::/var/snap/lxd/common/lxd:/bin/false
</code></pre></td></tr></table>
</div>
</div><p>Let&rsquo;s take these fields one by one.</p>
<ul>
<li>The first field is the user&rsquo;s login name.</li>
<li>The second field, at the beginning of the Unix era, used to contain an encrypted password. Nowadays, it contains the letter <code>x</code> to denote that a password has been assigned but was saved in <code>/etc/shadow</code> file. If this second field is blank, the user does not need to enter a password to log in.</li>
<li>The third field is the user ID, a positive integer number assigned to the user, followed by the primary group ID in the fourth field.</li>
<li>The fifth field is a comment. Sometimes it is left blank.</li>
<li>The next field is the user&rsquo;s home directory.</li>
<li>The last field is the default shell usually set to <code>/bin/bash</code>. If instead of bash you see there <code>nologin</code> of <code>false</code> it means there is a system user that‚Äôs not allowed to log into the system.</li>
</ul>
<p>That is the format of etc password.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="o">(</span>1<span class="o">)</span>ubuntu: user login name
<span class="o">(</span>2<span class="o">)</span>x: password was saved in <span class="sb">`</span>/etc/shadow<span class="sb">`</span>
<span class="o">(</span>3<span class="o">)</span>1000: user ID
<span class="o">(</span>4<span class="o">)</span>1000: group ID
<span class="o">(</span>5<span class="o">)</span>Ubuntu: comment
<span class="o">(</span>6<span class="o">)</span>/home/ubuntu: user home directory
<span class="o">(</span>7<span class="o">)</span>/bin/bash
</code></pre></td></tr></table>
</div>
</div><h2 id="etcshadow"><code>/etc/shadow</code></h2>
<p><code>/etc/shadow</code> stores the actual passwords of the users in an encrypted format. The <code>/etc/passwd</code> file is world-readable and that means that any user can read it but the <code>/etc/shadow</code> file is only readable by the root account.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">ubuntu@ip-172-31-87-26:~$ sudo cat /etc/shadow <span class="p">|</span> head -n <span class="m">5</span> 
root:<span class="nv">$6$3</span>L2TtFLTJR5Nz1sD<span class="nv">$x5UX</span>/leqXMB07ALQ/RAHGCGqXeZ9y23.UqNeygwp/gA.R9mh5CLDA6bMVXYBl/tqfXGvFzPuG9570cQ7xwjIV/:19100:0:99999:7:::
daemon:*:18960:0:99999:7:::
bin:*:18960:0:99999:7:::
sys:*:18960:0:99999:7:::
sync:*:18960:0:99999:7:::
</code></pre></td></tr></table>
</div>
</div><p>Each line of the file contains nine comma separated fields:</p>
<ul>
<li>The first field is the user name, and this is how a line in the <code>shadow</code> file is connected to the corresponding line in the <code>password</code> file.</li>
<li>The second field represents the password. If the password field contains an asterisk <code>*</code> or an exclamation <code>!</code> point the user will not be able to login to the system using the password authentication. Other login methods like key-based authentication or switching to the user are still allowed.</li>
<li>Then come 7 fields related to password expiration date like last password change, minimum and maximum passport age and so on. you can find a full description of these fields running <code>man shadow</code> in which has a full description of each field.</li>
</ul>
<p>Let‚Äôs take a deeper look at the password field.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="nv">$type</span> <span class="m">6</span>
<span class="nv">$salt</span> 3L2TtFLTJR5Nz1sD
<span class="nv">$hash</span> x5UX/leqXMB07ALQ/RAHGCGqXeZ9y23.UqNeygwp/gA.R9mh5CLDA6bMVXYBl/tqfXGvFzPuG9570cQ7xwjIV/
</code></pre></td></tr></table>
</div>
</div><p>Usually the password format is set to <code>$type$salt$hash</code>.</p>
<p>The <strong>type</strong>, 6 in this case, is the cryptographic hash algorithm used and can have the following values:</p>
<ul>
<li>1: MD5;</li>
<li>2a: Blowfish;</li>
<li>2y: Eksblowfish;</li>
<li>5: SHA-256;</li>
<li>6: SHA-512.</li>
</ul>
<p>The <strong>salt</strong> is randomly generated for each password, but it‚Äôs not secret like the password is. Then the salt combined with the password is added to the <strong>hashing</strong> process to enforce the uniqueness of the outhash, or in other words, the same password will give different hashes because of this random salt.</p>
<p>If through having the hash an attacker can find the clear text password, all the other similar passwords of other users are still secure because their hash is different.</p>
<p>We now create two user accounts <code>user1</code>, <code>user2</code> which has the same password <code>test123</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">ubuntu@ip-172-31-87-26:~$ sudo useradd user1
ubuntu@ip-172-31-87-26:~$ sudo passwd user1
New password: 
Retype new password: 
passwd: password updated successfully
ubuntu@ip-172-31-87-26:~$ sudo useradd user2
ubuntu@ip-172-31-87-26:~$ sudo passwd user2
New password: 
Retype new password: 
passwd: password updated successfully
ubuntu@ip-172-31-87-26:~$
ubuntu@ip-172-31-87-26:~$
ubuntu@ip-172-31-87-26:~$ cat /etc/passwd <span class="p">|</span> tail -n5
systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin
ubuntu:x:1000:1000:Ubuntu:/home/ubuntu:/bin/bash
lxd:x:998:100::/var/snap/lxd/common/lxd:/bin/false
user1:x:1001:1001::/home/user1:/bin/sh
user2:x:1002:1002::/home/user2:/bin/sh
</code></pre></td></tr></table>
</div>
</div><p>Now let&rsquo;s check the hashes in the shadow file.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">ubuntu@ip-172-31-87-26:~$ sudo cat /etc/shadow <span class="p">|</span> tail -n <span class="m">5</span>
systemd-coredump:!!:19096::::::
ubuntu:!:19096:0:99999:7:::
lxd:!:19096::::::
user1:<span class="nv">$6$OU</span>/fVA4GQsPufXdI<span class="nv">$wsJFgBDT0hnH4Fbm5xRI0RpaxBCZpQBqoOQT3RxWmZep</span>/yUehuyG25M.3.ZYcfrh/90wRWnqA9UWZqeSdpJmt1:19110:0:99999:7:::
user2:<span class="nv">$6$sUJt5NJm8RSMpllV$9</span>NYKlDsht5mZBvuFy5Dhrsi8R/098JdVgJS0FqnlHurMtmj9l6KcNjnWx3SfL8pekIazuQy7qyIBuhn1nCT411:19110:0:99999:7:::
</code></pre></td></tr></table>
</div>
</div><p>And we notice that even though both users have the same password, the saved hash is different. That&rsquo;s because it has computed the hash using both the common password and the salt, which is unique for each user. Now, if a hacker manages to find the password of the first user having the hash, the hacker doesn&rsquo;t know that the second user has the same password because there is another hash in the file.</p>
<blockquote>
<p><code>password</code> and <code>Shadow</code> file, should not be edited by hand unless you know what you are doing. Always use a command that is designed for this purpose.</p>
</blockquote>
<h2 id="etcgroup"><code>/etc/group</code></h2>
<p>The main purpose of the groups is to define a set of privileges or permissions like read, write or execute for a given file that can be shared among the users within the group. You have to add the user to a group if you want to have the privileges of the group.</p>
<p>In Linux, there are two types of groups that the user can belong to.</p>
<h3 id="primary-or-login-group">Primary or login group</h3>
<p>Primary group is the group that is assigned to the files that are created by the user. The group id of the primary group is stored in <code>/etc/passwd</code>(4th field) and the group name in <code>/etc/group</code>(1st field).</p>
<p>When a user creates a file, the user will be the owner of the file and file&rsquo;s primary group will be the group owner of the file. Remember that <strong>in Linux a file is owned by both a user and a group</strong>. I am creating a new file using <code>touch</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">ubuntu@ip-172-31-87-26:~$ touch a.txt
ubuntu@ip-172-31-87-26:~$ ls -l a.txt 
-rw-rw-r-- <span class="m">1</span> ubuntu ubuntu <span class="m">0</span> Apr <span class="m">28</span> 05:55 a.txt
</code></pre></td></tr></table>
</div>
</div><p>The user that runs <code>touch</code> command is the <strong>owner</strong> and its primary group (having usually the same name as the user) is the <strong>group owner</strong>. Note that <strong>each user must belong exactly to one primary group</strong>.</p>
<h3 id="secondary-or-supplementary-groups">Secondary or supplementary groups</h3>
<p>A user can be a member of none or more secondary groups. The secondary groups are stored in <code>/etc/group</code>.</p>
<p>Let&rsquo;s take the current user and see its entry in <code>/etc/passwd</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">ubuntu@ip-172-31-87-26:~$ grep ubuntu /etc/passwd
ubuntu:x:1000:1000:Ubuntu:/home/ubuntu:/bin/bash
</code></pre></td></tr></table>
</div>
</div><p>so from the 4th field, we know that the primary group of this user has the ID 1000. Let&rsquo;s search the <code>/etc/group</code> file for that ID.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">ubuntu@ip-172-31-87-26:~$ grep <span class="m">1000</span> /etc/group
ubuntu:x:1000:
</code></pre></td></tr></table>
</div>
</div><p>So the user&rsquo;s <strong>primary group</strong> is a group with the same name, ubuntu in this case; typically no other user will belong to this group. Now let&rsquo;s find out the <strong>secondary groups</strong> of the user; to do that, I&rsquo;ll search for the user name in the <code>/etc/group</code> file.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">ubuntu@ip-172-31-87-26:~$ grep ubuntu /etc/group
adm:x:4:syslog,ubuntu
dialout:x:20:ubuntu
cdrom:x:24:ubuntu
floppy:x:25:ubuntu
sudo:x:27:ubuntu
audio:x:29:ubuntu
dip:x:30:ubuntu
video:x:44:ubuntu
plugdev:x:46:ubuntu
netdev:x:117:ubuntu
lxd:x:118:ubuntu
ubuntu:x:1000:
</code></pre></td></tr></table>
</div>
</div><p>The last field of each line indicates the users that belong to that group as a secondary group. If there are more users belonging to the same group, then they are separated by a comma.</p>
<p>To summarize:</p>
<ul>
<li>find the primary group of the user:
<ul>
<li>grep user&rsquo;s name in <code>passwd</code> file to acquire the primary group id</li>
<li>grep primary group id in <code>group</code> file to acquire the primary group name</li>
<li>if the primary group name is equal to the user&rsquo;s name, then you can grep user&rsquo;s name in <code>group</code> file.</li>
</ul>
</li>
<li>find the secondary group of the user:
<ul>
<li>grep the user&rsquo;s name in <code>group</code> file.</li>
</ul>
</li>
</ul>
<p>the first field of <code>group</code> file is the names of groups; the 3rd field of the file is the group&rsquo;s id; the last field is the users belong to the group.</p>
<h3 id="groups-id-command"><code>groups</code>, <code>id</code> command</h3>
<p>Normally, you don&rsquo;t search through these files to find out to which groups a user belongs. There&rsquo;s the <code>groups</code> command that does the job for you.</p>
<p>When executed without any arguments, the command will print out a list of all groups the current user belongs to. And the first group is the primary one.</p>
<p>To get a list of all groups a specific user belongs to provide the user name to the <code>groups</code> command as argument.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">ubuntu@ip-172-31-87-26:~$ groups 
ubuntu adm dialout cdrom floppy sudo audio dip video plugdev netdev lxd
ubuntu@ip-172-31-87-26:~$ groups ubuntu
ubuntu : ubuntu adm dialout cdrom floppy sudo audio dip video plugdev netdev lxd
</code></pre></td></tr></table>
</div>
</div><p>Another useful command is <code>id</code>. It prints information about the specified user and its groups and as the <code>groups</code> command, if the username is omitted, it shows information for the current user.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">ubuntu@ip-172-31-87-26:~$ id
<span class="nv">uid</span><span class="o">=</span>1000<span class="o">(</span>ubuntu<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1000<span class="o">(</span>ubuntu<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>1000<span class="o">(</span>ubuntu<span class="o">)</span>,4<span class="o">(</span>adm<span class="o">)</span>,20<span class="o">(</span>dialout<span class="o">)</span>,24<span class="o">(</span>cdrom<span class="o">)</span>,25<span class="o">(</span>floppy<span class="o">)</span>,27<span class="o">(</span>sudo<span class="o">)</span>,29<span class="o">(</span>audio<span class="o">)</span>,30<span class="o">(</span>dip<span class="o">)</span>,44<span class="o">(</span>video<span class="o">)</span>,46<span class="o">(</span>plugdev<span class="o">)</span>,117<span class="o">(</span>netdev<span class="o">)</span>,118<span class="o">(</span>lxd<span class="o">)</span>
ubuntu@ip-172-31-87-26:~$ id ubuntu
<span class="nv">uid</span><span class="o">=</span>1000<span class="o">(</span>ubuntu<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1000<span class="o">(</span>ubuntu<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>1000<span class="o">(</span>ubuntu<span class="o">)</span>,4<span class="o">(</span>adm<span class="o">)</span>,20<span class="o">(</span>dialout<span class="o">)</span>,24<span class="o">(</span>cdrom<span class="o">)</span>,25<span class="o">(</span>floppy<span class="o">)</span>,27<span class="o">(</span>sudo<span class="o">)</span>,29<span class="o">(</span>audio<span class="o">)</span>,30<span class="o">(</span>dip<span class="o">)</span>,44<span class="o">(</span>video<span class="o">)</span>,46<span class="o">(</span>plugdev<span class="o">)</span>,117<span class="o">(</span>netdev<span class="o">)</span>,118<span class="o">(</span>lxd<span class="o">)</span>
</code></pre></td></tr></table>
</div>
</div><p>The command is showing the user ID 1000, the user&rsquo;s primary group and group id and the user&rsquo;s secondary groups and their id.</p>
<h1 id="user">User</h1>
<h2 id="create-user">Create user</h2>
<h3 id="useradd-command"><code>useradd</code> command</h3>
<p>In Linux you need root privileges to create, change or delete an account. To create a new account you run the <code>useradd</code> command. Run <code>man useradd</code> and you‚Äôll see lots of options.</p>
<p>To create a new user without specifying any options, just run <code>useradd</code> and the new username:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">ubuntu@ip-172-31-87-26:~$ sudo useradd u1
ubuntu@ip-172-31-87-26:~$ tail -n <span class="m">5</span> /etc/passwd
ubuntu:x:1000:1000:Ubuntu:/home/ubuntu:/bin/bash
lxd:x:998:100::/var/snap/lxd/common/lxd:/bin/false
user1:x:1001:1001::/home/user1:/bin/sh
user2:x:1002:1002::/home/user2:/bin/sh
u1:x:1003:1003::/home/u1:/bin/sh
</code></pre></td></tr></table>
</div>
</div><p>And the last user is <code>u1</code>, the user that have just created.  By default, for the new user a group with the same name as the user name was also created.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">ubuntu@ip-172-31-87-26:~$ groups u1
u1 : u1
</code></pre></td></tr></table>
</div>
</div><p>And it belongs to only one group called <code>u1</code>; this is its primary group. Note that the default behavior of <code>useradd</code> can differ from distribution to distribution;</p>
<blockquote>
<p>On some distributions, especially those based on Ubuntu, you&rsquo;ll see another command called <code>adduser</code>. <code>useradd</code> is a native binary compiled with any Linux system. But, <code>adduser</code> is just a perl script which uses <code>useradd</code> binary as a back-end. <code>adduser</code> is more user friendly and interactive than its back-end <code>useradd</code>. There is no actual difference in features provided.</p>
</blockquote>
<h3 id="passwd-command"><code>passwd</code> command</h3>
<p><code>useradd</code> reads the contents of the file <code>/etc/login.def</code> which contains options for the shadow password, such as password expiration policy, ranges of user IDs used when creating system and regular users and more. <strong>To be able to login</strong> , we need to set a password to the newly created user; to do that <code>passwd</code> command followed by the username.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">ubuntu@ip-172-31-87-26:~$ sudo passwd u1
New password: 
Retype new password: 
passwd: password updated successfully
</code></pre></td></tr></table>
</div>
</div><p>Now the user has a password and can login.</p>
<h3 id="-m"><code>-m</code></h3>
<p>If a user is created without any option, its home directory is not created as well. If you want to create the user&rsquo;s home directory, use the <code>-m</code> option, and the directory name will be the same as the username and will be created in <code>/home</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">ubuntu@ip-172-31-87-26:~$ sudo useradd -m u2
ubuntu@ip-172-31-87-26:~$ ls ~/..
u2  ubuntu
</code></pre></td></tr></table>
</div>
</div><h3 id="-d"><code>-d</code></h3>
<p>If you want to give it another name or create it in another location add the <code>-d</code> option to <code>-m</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">ubuntu@ip-172-31-87-26:~$ sudo useradd -md /home/uu3 u3
ubuntu@ip-172-31-87-26:~$ ls ~/..
u2  ubuntu  uu3
</code></pre></td></tr></table>
</div>
</div><h3 id="-c"><code>-c</code></h3>
<p>If you want to add a comment to the user entry in <code>/etc/ passwd</code> file, add the <code>-c</code> option and a comment between quotes. This comment is typically a short description, like the user&rsquo;s full name or the contact information.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">ubuntu@ip-172-31-87-26:~$ sudo useradd -c <span class="s2">&#34;comment for u4&#34;</span> u4
ubuntu@ip-172-31-87-26:~$ tail -n <span class="m">5</span> /etc/passwd
user2:x:1002:1002::/home/user2:/bin/sh
u1:x:1003:1003::/home/u1:/bin/sh
u2:x:1004:1004::/home/u2:/bin/sh
u3:x:1005:1005::/home/uu3:/bin/sh
u4:x:1006:1006:comment <span class="k">for</span> u4:/home/u4:/bin/sh
</code></pre></td></tr></table>
</div>
</div><h3 id="-g--g"><code>-g</code>, <code>-G</code></h3>
<p>By default, the primary group of the user will be a group with the same name as the user. If you want to add this user to another primary group, use the <code>-g</code> option and the name of the group. However, this is not common. What is common is to add the user to some secondary groups as well. To do that, use the capital <code>-G</code> option and the secondary groups with a comma between them.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">ubuntu@ip-172-31-87-26:~$ sudo useradd -G sudo,adm,video u6
ubuntu@ip-172-31-87-26:~$ groups u6
u6 : u6 adm sudo video
</code></pre></td></tr></table>
</div>
</div><p>Note that the groups should already exist or you&rsquo;ll get an error.</p>
<h3 id="-e"><code>-e</code></h3>
<p>If you want to create a temporary user, then you should specify an expiration date, the date on which the user account will be disabled. Use the <code>-e</code> option and the date in the format <code>yyyy-mm-dd</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">ubuntu@ip-172-31-87-26:~$ sudo useradd -e 2021-12-31 u7
</code></pre></td></tr></table>
</div>
</div><p>If you want to change the user&rsquo;s password expire policy of an existing user run the <code>chage</code> command and the username.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">ubuntu@ip-172-31-87-26:~$ sudo chage u7
Changing the aging information <span class="k">for</span> u7
Enter the new value, or press ENTER <span class="k">for</span> the default

	Minimum Password Age <span class="o">[</span>0<span class="o">]</span>: 
	Maximum Password Age <span class="o">[</span>99999<span class="o">]</span>: 
	Last Password Change <span class="o">(</span>YYYY-MM-DD<span class="o">)</span> <span class="o">[</span>2021-04-29<span class="o">]</span>: 
	Password Expiration Warning <span class="o">[</span>7<span class="o">]</span>: 
	Password Inactive <span class="o">[</span>-1<span class="o">]</span>: 
	Account Expiration Date <span class="o">(</span>YYYY-MM-DD<span class="o">)</span> <span class="o">[</span>2021-12-31<span class="o">]</span>: 
</code></pre></td></tr></table>
</div>
</div><p>And if you want to list the expiration information only, add <code>-l</code> option to <code>chage</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">ubuntu@ip-172-31-87-26:~$ sudo chage -l u7
Last password change					: Apr 29, <span class="m">2021</span>
Password expires					: never
Password inactive					: never
Account expires						: Dec 31, <span class="m">2021</span>
Minimum number of days between password change		: <span class="m">0</span>
Maximum number of days between password change		: <span class="m">99999</span>
Number of days of warning before password expires	: <span class="m">7</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="-s"><code>-s</code></h3>
<p>In computing, a <strong>shell is a computer program</strong> (an executable file in Linux) which exposes an operating system&rsquo;s services to a human user or other programs. In general, operating system shells use either a command-line interface (CLI) or graphical user interface (GUI), depending on a computer&rsquo;s role and particular operation. It is named a shell because it is the outermost layer around the operating system.</p>
<p>To create the user with a specific login shell at the <code>-s</code> option and the absolute path to that shell. That shell will be automatically launched when the user logs in or opens a terminal. We usually use <code>/bin/bash</code> shell.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">ubuntu@ip-172-31-87-26:~$ sudo useradd -s /bin/bash u5
ubuntu@ip-172-31-87-26:~$ tail -n <span class="m">5</span> /etc/passwd
u1:x:1003:1003::/home/u1:/bin/sh
u2:x:1004:1004::/home/u2:/bin/sh
u3:x:1005:1005::/home/uu3:/bin/sh
u4:x:1006:1006:comment <span class="k">for</span> u4:/home/u4:/bin/sh
u5:x:1007:1007::/home/u5:/bin/bash
</code></pre></td></tr></table>
</div>
</div><p>If you take a look in <code>/etc/passwd</code> you‚Äôll see that some accounts have as shell something like <code>/usr/bin/nologin</code> (or <code>/usr/sbin/nologin</code>) or <code>/bin/false</code>.</p>
<p><img src="https://raw.githubusercontent.com/floating15/img/main/202204291523111.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>Sometimes you need a system account to be used only to run a service such as a Web server. In Linux every daemon or process should be run as a specific user and it‚Äôs recommended not to be root. This is an important security consideration. To have such a limited user account, that never logs in, you set its shell as being <code>false</code> or <code>nologin</code>. If <code>nologin</code> is set as the user&rsquo;s shell, when the user tries to login, it will get a message saying this account is currently not available. And <code>false</code>, is just a binary that immediately exists, returning false when called. That&rsquo;s why when someone that has false as shell logs in is immediately logged out. There isn&rsquo;t actually such a big difference between <code>nologin</code> and <code>false</code>.</p>
<p>By the way, <code>/bin/bash</code>, <code>/usr/sbin/nologin</code>, <code>/bin/false</code> and the default shell when user is created <code>/bin/sh</code> and all executable files:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">ubuntu@ip-172-31-87-26:~$ ls -lF /bin/bash /usr/sbin/nologin /bin/false /bin/sh
-rwxr-xr-x <span class="m">1</span> root root <span class="m">1183448</span> Apr <span class="m">18</span> 09:14 /bin/bash*
-rwxr-xr-x <span class="m">1</span> root root   <span class="m">39256</span> Sep  <span class="m">5</span>  <span class="m">2019</span> /bin/false*
lrwxrwxrwx <span class="m">1</span> root root       <span class="m">4</span> Nov <span class="m">29</span> 23:30 /bin/sh -&gt; dash*
-rwxr-xr-x <span class="m">1</span> root root   <span class="m">14640</span> Jul <span class="m">14</span>  <span class="m">2021</span> /usr/sbin/nologin*
</code></pre></td></tr></table>
</div>
</div><h2 id="change-property">Change property</h2>
<p>Let&rsquo;s see how to change the properties of an existing user.</p>
<p>All of the information about a user is stored in the following files:<code> /etc/passwd</code>, <code>/etc/shadow</code> that can be displayed only by root, <code>/etc/group</code> and <code>/etc/gshadow</code>; there&rsquo;s also <code>/etc/login.defs</code> which contains the default options of a new user (if they are not specified when creating that user). Such an example is the fact that it&rsquo;s not explicitly indicated if the home directory is created or not. The shell commands that create, change or remove a user or a group are in fact only modifying these files.</p>
<p><code>usermod</code> is the shell command used to change the properties of an existing user. It uses the same options as <code>useradd</code> just so that instead of creating a user with the specified options, it changes those options.</p>
<p>For example change or add a comment for an existing user.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">ubuntu@ip-172-31-87-26:~$ sudo usermod -c <span class="s2">&#34;cmt for user 7&#34;</span> u7
ubuntu@ip-172-31-87-26:~$ tail -n <span class="m">3</span> /etc/passwd
u5:x:1007:1007::/home/u5:/bin/bash
u6:x:1008:1008::/home/u6:/bin/sh
u7:x:1009:1009:cmt <span class="k">for</span> user 7:/home/u7:/bin/sh
</code></pre></td></tr></table>
</div>
</div><p>To change the primary group of user use, the <code>-g</code> option and the name. Note that the group name, in this case <code>u6</code>, must already exist.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">ubuntu@ip-172-31-87-26:~$ groups u7
u7 : u7
ubuntu@ip-172-31-87-26:~$ sudo usermod -g u6 u7
ubuntu@ip-172-31-87-26:~$ groups u7
u7 : u6
</code></pre></td></tr></table>
</div>
</div><p><code>usermod</code> does not delete the group <code>u7</code>, and you can set it back.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">ubuntu@ip-172-31-87-26:~$ sudo usermod -g u7 u7
ubuntu@ip-172-31-87-26:~$ groups u7
u7 : u7
</code></pre></td></tr></table>
</div>
</div><p>If you want to add the user to some secondary groups use the <code>-G</code> option. Each group is separated from the next one by a comma, with no intervening whitespace.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">ubuntu@ip-172-31-87-26:~$ groups u6
u6 : u6 adm sudo video
ubuntu@ip-172-31-87-26:~$ sudo usermod -G dip,lxd u6
ubuntu@ip-172-31-87-26:~$ groups u6
u6 : u6 dip lxd
</code></pre></td></tr></table>
</div>
</div><p>Note that the primary group was not modified and the user belongs only to those 2 groups as secondary groups. If the user is currently a member of a group, which is not specified as an option of <code>-G</code>, then the user will be removed from that group. Or in other words, after running the command, the user will be a member of those groups only, in this case <code>dip</code> and <code>lxd</code> groups. The user is not anymore a member of <code>adm</code>, <code>video</code> or <code>sudo</code>. This behavior can be changed via <code>-a</code> option, which appends the user to the current secondary group list.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">ubuntu@ip-172-31-87-26:~$ sudo usermod -aG plugdev,audio u6
ubuntu@ip-172-31-87-26:~$ groups u6
u6 : u6 audio dip plugdev lxd
</code></pre></td></tr></table>
</div>
</div><h2 id="delete-user">Delete user</h2>
<p>In Linux you can delete a user account and all its associated files by using the <code>userdel</code> command. It also deletes the group with the same name as the user, only if no other user is a member of that group. Let&rsquo;s delete an account.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">ubuntu@ip-172-31-87-26:~$ ls /home
u2  ubuntu  uu3
ubuntu@ip-172-31-87-26:~$ sudo userdel u2
ubuntu@ip-172-31-87-26:~$ ls /home
u2  ubuntu  uu3
ubuntu@ip-172-31-87-26:~$ grep u2 /etc/passwd
ubuntu@ip-172-31-87-26:~$ 
</code></pre></td></tr></table>
</div>
</div><p>The account <code>u2</code>  was removed, but its home directory is still there. To remove a user along with its home directory and mail spool use the <code>-r</code> option.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">ubuntu@ip-172-31-87-26:~$ sudo usermod -g u4 u3
ubuntu@ip-172-31-87-26:~$ groups u3
u3 : u4
ubuntu@ip-172-31-87-26:~$ ls ~/..
u2  ubuntu  uu3
ubuntu@ip-172-31-87-26:~$ sudo userdel -r u3
userdel: group u3 not removed because it is not the primary group of user u3.
userdel: u3 mail spool <span class="o">(</span>/var/mail/u3<span class="o">)</span> not found
ubuntu@ip-172-31-87-26:~$ ls /home
u2  ubuntu
</code></pre></td></tr></table>
</div>
</div><p>The user was removed. It&rsquo;s home directory was removed, but the group with the same name called <code>u3</code> was not removed because it was not the primary group of the user <code>u3</code>; and the user <code>u3</code>&rsquo;s primary group <code>u4</code> was also not removed, because it is the primary group of user <code>u4</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">ubuntu@ip-172-31-87-26:~$ cat /etc/group <span class="p">|</span> grep u<span class="o">[</span>1-9<span class="o">]</span>
audio:x:29:ubuntu,u6
dip:x:30:ubuntu,u6
plugdev:x:46:ubuntu,u6
lxd:x:118:ubuntu,u6
u1:x:1003:
u3:x:1005:
u4:x:1006:
u5:x:1007:
u6:x:1008:
u7:x:1009:
ubuntu@ip-172-31-87-26:~$ groups u4
u4 : u4
</code></pre></td></tr></table>
</div>
</div><p>Note that the command didn&rsquo;t delete any other files that belong to the user and are located in other places; you have to search for and delete them manually.</p>
<blockquote>
<p>As with <code>useradd</code>, <code>userdel</code> is a low level utility, but Debian and Ubuntu distributions have a friendlier command called <code>deluser</code>. It just uses <code>userdel</code> as a backend.</p>
</blockquote>
<h2 id="create-admin-user">Create admin user</h2>
<p>A common administrative task is to give the user the possibility to run administrative commands as root. By default only the user created at system installation time can run commands as root by prefixing them with <code>sudo</code>.</p>
<p>There are 2 predefined group names: <code>sudo</code> on debian and ubuntu based distributions (BTW in older versions of ubuntu this group&rsquo;s name was <code>admin</code>.) and <code>wheel</code> on redhat and centos based distributions. If the user is part of this group then it can run commands as root.</p>
<p>For example, I‚Äôm creating a new user called <code>u8</code> and then check if it can run commands as root:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">ubuntu@ip-172-31-87-26:~$ sudo useradd -m u8
ubuntu@ip-172-31-87-26:~$ sudo passwd u8
New password: 
Retype new password: 
passwd: password updated successfully
ubuntu@ip-172-31-87-26:~$ su u8
Password: 
$ id
<span class="nv">uid</span><span class="o">=</span>1010<span class="o">(</span>u8<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1011<span class="o">(</span>u8<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>1011<span class="o">(</span>u8<span class="o">)</span>
</code></pre></td></tr></table>
</div>
</div><p>And now I&rsquo;m <code>u8</code>, Let&rsquo;s see if it can run administrative commands:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">$ cat /etc/shadow
cat: /etc/shadow: Permission denied
$ sudo cat /etc/shadow
<span class="o">[</span>sudo<span class="o">]</span> password <span class="k">for</span> u8: 
u8 is not in the sudoers file.  This incident will be reported.
</code></pre></td></tr></table>
</div>
</div><p>And it&rsquo;s not allowed. I&rsquo;m logging out by <code>exit</code>. You can see that user <code>u8</code> only has a <code>$</code> as prompt, that because we haven&rsquo;t set shell for <code>u8</code>. Now set it&rsquo;s shell as <code>/bin/bash</code> and add <code>u8</code> in group <code>sudo</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">ubuntu@ip-172-31-87-26:~$ sudo usermod -s /bin/bash -aG sudo u8
ubuntu@ip-172-31-87-26:~$ su u8
Password: 
To run a <span class="nb">command</span> as administrator <span class="o">(</span>user <span class="s2">&#34;root&#34;</span><span class="o">)</span>, use <span class="s2">&#34;sudo &lt;command&gt;&#34;</span>.
See <span class="s2">&#34;man sudo_root&#34;</span> <span class="k">for</span> details.

u8@ip-172-31-87-26:/home/ubuntu$ id
<span class="nv">uid</span><span class="o">=</span>1010<span class="o">(</span>u8<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1011<span class="o">(</span>u8<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>1011<span class="o">(</span>u8<span class="o">)</span>,27<span class="o">(</span>sudo<span class="o">)</span>
u8@ip-172-31-87-26:/home/ubuntu$ sudo cat /etc/shadow <span class="p">|</span> tail -n <span class="m">3</span>
<span class="o">[</span>sudo<span class="o">]</span> password <span class="k">for</span> u8: 
u6:!:19111:0:99999:7:::
u7:!:19111:0:99999:7::19357:
u8:<span class="nv">$6$EEryHMMe70k6tYzh$jgHahiEp89iwwX</span>/ngdU0WNHg1Vjci.6lHoqY05omT.5s/VIEob2gpxSlo41KKrDmnpanvIwL11uxZpyc8zgvU1:19111:0:99999:7:::
u8@ip-172-31-87-26:/home/ubuntu$ <span class="nb">exit</span>
<span class="nb">exit</span>
ubuntu@ip-172-31-87-26:~$ id
<span class="nv">uid</span><span class="o">=</span>1000<span class="o">(</span>ubuntu<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1000<span class="o">(</span>ubuntu<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>1000<span class="o">(</span>ubuntu<span class="o">)</span>,4<span class="o">(</span>adm<span class="o">)</span>,20<span class="o">(</span>dialout<span class="o">)</span>,24<span class="o">(</span>cdrom<span class="o">)</span>,25<span class="o">(</span>floppy<span class="o">)</span>,27<span class="o">(</span>sudo<span class="o">)</span>,29<span class="o">(</span>audio<span class="o">)</span>,30<span class="o">(</span>dip<span class="o">)</span>,44<span class="o">(</span>video<span class="o">)</span>,46<span class="o">(</span>plugdev<span class="o">)</span>,117<span class="o">(</span>netdev<span class="o">)</span>,118<span class="o">(</span>lxd<span class="o">)</span>
</code></pre></td></tr></table>
</div>
</div><p>And It was allowed to run the command as root. That&rsquo;s because the user belongs to the sudo group.</p>
<h1 id="group">Group</h1>
<p>To create a new group use the <code>groupadd</code> command. In its simplest form you just specify the group name as argument.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">ubuntu@ip-172-31-87-26:~$ sudo addgroup g1
Adding group <span class="sb">`</span>g1<span class="err">&#39;</span> <span class="o">(</span>GID 1004<span class="o">)</span> ...
Done.
ubuntu@ip-172-31-87-26:~$ sudo tail -n <span class="m">3</span> /etc/group
u3:x:1010:
u8:x:1011:
g1:x:1004:
</code></pre></td></tr></table>
</div>
</div><p>And the group was added to the group file. Once the group is created, you can start adding users to the group; use the <code>useradd</code> or <code>usermod</code> command with the <code>-G</code> option.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">ubuntu@ip-172-31-87-26:~$ sudo useradd -G g1 u9
ubuntu@ip-172-31-87-26:~$ groups u9
u9 : u9 g1
</code></pre></td></tr></table>
</div>
</div><p>To change the name of the group, used the group <code>groupmod</code> command with <code>-n</code> option and the new name.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">ubuntu@ip-172-31-87-26:~$ sudo groupmod -n g2 g1
ubuntu@ip-172-31-87-26:~$ groups u9
u9 : u9 g2
</code></pre></td></tr></table>
</div>
</div><p>To delete a group run the <code>groupdel</code> command followed by the groupname.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">ubuntu@ip-172-31-87-26:~$ sudo groupdel g2
ubuntu@ip-172-31-87-26:~$ groups u9
u9 : u9
</code></pre></td></tr></table>
</div>
</div><p>On success, the groupdel command does not print any output. if the group plan to remove doesn&rsquo;t exist, the system will print an error message saying that the group does not exist.</p>
<p>Note that it&rsquo;s not possible to move the primary group of an existing user without first removing the user.</p>
<h1 id="user-account-monitoring">User Account Monitoring</h1>
<p>User account monitoring, which means finding out who&rsquo;s logged into the system and what the users do. Because in Linux you can log in as a user and become another one by running the <code>su</code> command that there are two concepts: the real user ID and the effective user ID.</p>
<p>The real user ID or are RUID is the id of the user who initially logs in and never changes. On the other hand, EUID or effective user ID is the id of the user who executes a command in the shell. For example, I log in as ubuntu. This is the real user ID, but I can become <code>root</code> by running <code>sudo su</code>. Now, the effective user ID is root.</p>
<h2 id="whoami-id-command"><code>whoami</code>, <code>id</code> command</h2>
<p>the <code>whoami</code> command, prints out the user name of the effective user ID who is root in this case. It‚Äôs equivalent to <code>id -un</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">ubuntu@ip-172-31-87-26:~$ whoami
ubuntu
ubuntu@ip-172-31-87-26:~$ sudo su
root@ip-172-31-87-26:/home/ubuntu# whoami
root
root@ip-172-31-87-26:/home/ubuntu# id -un
root
root@ip-172-31-87-26:/home/ubuntu# <span class="nb">exit</span>
<span class="nb">exit</span>
ubuntu@ip-172-31-87-26:~$ id -un
ubuntu
</code></pre></td></tr></table>
</div>
</div><p>Another useful command is <code>id</code>, which prints the effective user and its groups.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">ubuntu@ip-172-31-87-26:~$ sudo su
root@ip-172-31-87-26:/home/ubuntu# id
<span class="nv">uid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="who-command"><code>who</code> command</h2>
<p>To display the name of the real user id run <code>who</code>. The name of the user who initially logged in is <code>ubuntu</code>. If you want to find out who&rsquo;s logged into your system run <code>who</code>.</p>
<blockquote>
<p>What the <code>who</code> command does is parsing and displaying the contents of <code>/var/run/utmp</code>. This is the file which logs the current users on the system. There is also another file <code>/var/log/wtmp</code> which is like history for the <code>utmp</code> file, it maintains the logs of all logged in and logged out users in the past. Each time a user logs into the system, a record for that session is written to a file <code>/var/log/wtmp</code>.</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">root@ip-172-31-87-26:/home/ubuntu# who
ubuntu   pts/0        2021-04-29 06:51 <span class="o">(</span>174.139.202.93<span class="o">)</span>
</code></pre></td></tr></table>
</div>
</div><p>At this moment, there is only one user logged in. We will discuss this again when we reach the &ldquo;Network Management in Linux&rdquo; topic.</p>
<p>To display the IP address of the logged in user and the time when it logged in, add <code>-H</code> option.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">root@ip-172-31-87-26:/home/ubuntu# who -H
NAME     LINE         TIME             COMMENT
ubuntu   pts/0        2021-04-29 06:51 <span class="o">(</span>174.139.202.93<span class="o">)</span>
</code></pre></td></tr></table>
</div>
</div><p>You can also add the <code>-a</code> option to display more information.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">root@ip-172-31-87-26:/home/ubuntu# who -a
           system boot  2021-04-14 01:53
LOGIN      ttyS0        2021-04-14 01:54               <span class="m">578</span> <span class="nv">id</span><span class="o">=</span>tyS0
LOGIN      tty1         2021-04-14 01:54               <span class="m">616</span> <span class="nv">id</span><span class="o">=</span>tty1
           run-level <span class="m">5</span>  2021-04-14 01:54
ubuntu   + pts/0        2021-04-29 06:51   .        <span class="m">138433</span> <span class="o">(</span>174.139.202.93<span class="o">)</span>
           pts/1        2021-04-22 09:38            <span class="m">103062</span> <span class="nv">id</span><span class="o">=</span>ts/1  <span class="nv">term</span><span class="o">=</span><span class="m">0</span> <span class="nv">exit</span><span class="o">=</span><span class="m">0</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="w-command"><code>w</code> command</h2>
<p>For a little more context about users, the simple <code>w</code> command provides a list of who&rsquo;s logged in and what they are doing, what&rsquo;s their current process.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">root@ip-172-31-87-26:/home/ubuntu# w
 09:32:12 up <span class="m">15</span> days,  7:38,  <span class="m">1</span> user,  load average: 0.00, 0.00, 0.00
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
ubuntu   pts/0    174.139.202.93   06:51    0.00s  0.24s  0.01s sshd: ubun
</code></pre></td></tr></table>
</div>
</div><p>The header shows:</p>
<ul>
<li>the current time,</li>
<li>how long the system has been running, 15 days 7 hours and 38 minutes.</li>
<li>how many users are currently logged in,</li>
<li>the system load average for the past 1, and 15 minutes. Notice that the values for these load averages should be below 1 or there&rsquo;s a problem.</li>
</ul>
<p>The same information can be displayed running the <code>uptime</code> command.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">root@ip-172-31-87-26:/home/ubuntu# uptime
 09:34:20 up <span class="m">15</span> days,  7:40,  <span class="m">1</span> user,  load average: 0.00, 0.00, 0.00
</code></pre></td></tr></table>
</div>
</div><h2 id="last"><code>last</code></h2>
<p><code>last</code> is very useful when you need to track users activity or investigate a possible security breach. It shows a listing of the last logged in users.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">root@ip-172-31-87-26:/home/ubuntu# last <span class="p">|</span> head -n <span class="m">5</span>
ubuntu   pts/0        174.139.202.93   Fri Apr <span class="m">29</span> 06:51   still logged in
ubuntu   pts/0        174.139.202.93   Thu Apr <span class="m">28</span> 03:37 - 06:16  <span class="o">(</span>02:39<span class="o">)</span>
ubuntu   pts/0        174.139.202.93   Wed Apr <span class="m">27</span> 02:52 - 05:56  <span class="o">(</span>03:03<span class="o">)</span>
ubuntu   pts/0        174.139.202.93   Tue Apr <span class="m">26</span> 02:13 - 05:09  <span class="o">(</span>02:56<span class="o">)</span>
ubuntu   pts/0        174.139.202.93   Tue Apr <span class="m">26</span> 02:09 - 02:12  <span class="o">(</span>00:02<span class="o">)</span>
</code></pre></td></tr></table>
</div>
</div><p><code>last</code> reads the <code>/var/log/wtmp</code> file, and prints information about the logins and logouts of the users. Records are printed in reverse order, starting from the most recent ones. And if you want to restrict the output to a specific user give that username as argument to last, for example,</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">root@ip-172-31-87-26:/home/ubuntu# last reboot
reboot   system boot  5.11.0-1022-aws  Thu Apr <span class="m">14</span> 01:53   still running
</code></pre></td></tr></table>
</div>
</div><p>The command has some options that could prove useful sometimes that can be find more information about them in the <code>man</code> page of the command.</p>
<h1 id="compendium">Compendium</h1>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="c1">##########################</span>
<span class="c1">## Account Management</span>
<span class="c1">##########################</span>
 
<span class="c1">## IMPORTANT FILES</span>
<span class="c1"># /etc/passwd # =&gt; users and info: username:x:uid:gid:comment:home_directory:login_shell</span>
<span class="c1"># /etc/shadow # =&gt; users&#39; passwords</span>
<span class="c1"># /etc/group # =&gt; groups</span>
 
<span class="c1"># creating a user account</span>
useradd <span class="o">[</span>OPTIONS<span class="o">]</span> username
<span class="c1"># OPTIONS:</span>
<span class="c1"># -m =&gt; create home directory</span>
<span class="c1"># -d directory =&gt; specify another home directory</span>
<span class="c1"># -c &#34;comment&#34;</span>
<span class="c1"># -s shell</span>
<span class="c1"># -G =&gt; specify the secondary groups (must exist)</span>
<span class="c1"># -g =&gt; specify the primary group (must exist)</span>
 
Exemple:
useradd -m -d /home/john -c <span class="s2">&#34;C++ Developer&#34;</span> -s /bin/bash -G sudo,adm,mail john
 
<span class="c1"># changing a user account</span>
usermod <span class="o">[</span>OPTIONS<span class="o">]</span> username <span class="c1"># =&gt; uses the same options as useradd</span>
Example:
usermod -aG developers,managers john <span class="c1"># =&gt; adding the user to two secondary groups</span>
 
<span class="c1"># deleting a user account</span>
userdel -r username <span class="c1"># =&gt; -r removes user&#39;s home directory as well</span>
 
<span class="c1"># creating a group</span>
groupadd group_name
 
<span class="c1"># deleting a group</span>
groupdel group_name
 
<span class="c1"># displaying all groups</span>
cat /etc/groups
 
<span class="c1"># displaying the groups a user belongs to</span>
groups
 
<span class="c1"># creating admin users</span>
<span class="c1"># add the user to sudo group in Ubuntu and wheel group in CentOS</span>
usermod -aG sudo john
 
 
<span class="c1">## Monitoring Users ##</span>
who -H <span class="c1"># =&gt; displays logged in users</span>
id <span class="c1"># =&gt; displays the current user and its groups</span>
whoami <span class="c1"># =&gt; displays EUID</span>
 
<span class="c1"># listing who‚Äôs logged in and what‚Äôs their current process.</span>
w
uptime
 
<span class="c1"># printing information about the logins and logouts of the users</span>
last
last -u username
</code></pre></td></tr></table>
</div>
</div>
</section>


    <footer class="article-footer">
    

    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
        <link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css"integrity="sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn"crossorigin="anonymous"
            ><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js"integrity="sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8"crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js"integrity="sha384-vZTG03m&#43;2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl"crossorigin="anonymous"
                defer
                >
            </script><script>
    window.addEventListener("DOMContentLoaded", () => {
        renderMathInElement(document.querySelector(`.article-content`), {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true }
            ]
        });})
</script>
    
</article>

    

    

<aside class="related-contents--wrapper">
    <h2 class="section-title">Related contents</h2>
    <div class="related-contents">
        <div class="flex article-list--tile">
            
                
<article class="">
    <a href="/p/linux-operation-system-iii-file-system-2/">
        
        

        <div class="article-details">
            <h2 class="article-title">Linux Operation System III (File System 2)</h2>
        </div>
    </a>
</article>
            
                
<article class="">
    <a href="/p/linux-operation-system-ii-file-system-1/">
        
        

        <div class="article-details">
            <h2 class="article-title">Linux Operation System II (File System 1)</h2>
        </div>
    </a>
</article>
            
                
<article class="">
    <a href="/p/linux-operation-system-i-terminal/">
        
        

        <div class="article-details">
            <h2 class="article-title">Linux Operation System I (Terminal)</h2>
        </div>
    </a>
</article>
            
        </div>
    </div>
</aside>

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2020 - 
        
        2022 Haoming Wang
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.11.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>

</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css"integrity="sha256-c0uckgykQ9v5k&#43;IqViZOZKc47Jn7KQil4/MP3ySA3F8="crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css"integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE="crossorigin="anonymous"
            >

            </main>
    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">Table of contents</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#passwd-shadow-and-group-file"><code>passwd</code>, <code>shadow</code> and <code>group</code> file</a>
      <ol>
        <li><a href="#etcpasswd"><code>/etc/passwd</code></a></li>
        <li><a href="#etcshadow"><code>/etc/shadow</code></a></li>
        <li><a href="#etcgroup"><code>/etc/group</code></a>
          <ol>
            <li><a href="#primary-or-login-group">Primary or login group</a></li>
            <li><a href="#secondary-or-supplementary-groups">Secondary or supplementary groups</a></li>
            <li><a href="#groups-id-command"><code>groups</code>, <code>id</code> command</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#user">User</a>
      <ol>
        <li><a href="#create-user">Create user</a>
          <ol>
            <li><a href="#useradd-command"><code>useradd</code> command</a></li>
            <li><a href="#passwd-command"><code>passwd</code> command</a></li>
            <li><a href="#-m"><code>-m</code></a></li>
            <li><a href="#-d"><code>-d</code></a></li>
            <li><a href="#-c"><code>-c</code></a></li>
            <li><a href="#-g--g"><code>-g</code>, <code>-G</code></a></li>
            <li><a href="#-e"><code>-e</code></a></li>
            <li><a href="#-s"><code>-s</code></a></li>
          </ol>
        </li>
        <li><a href="#change-property">Change property</a></li>
        <li><a href="#delete-user">Delete user</a></li>
        <li><a href="#create-admin-user">Create admin user</a></li>
      </ol>
    </li>
    <li><a href="#group">Group</a></li>
    <li><a href="#user-account-monitoring">User Account Monitoring</a>
      <ol>
        <li><a href="#whoami-id-command"><code>whoami</code>, <code>id</code> command</a></li>
        <li><a href="#who-command"><code>who</code> command</a></li>
        <li><a href="#w-command"><code>w</code> command</a></li>
        <li><a href="#last"><code>last</code></a></li>
      </ol>
    </li>
    <li><a href="#compendium">Compendium</a></li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js"integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

<script
    src="https://cdn.jsdelivr.net/gh/zhixuan2333/gh-blog@v0.1.0/js/ribbon.min.js"
    integrity="sha384-UEK8ZiP3VgFNP8KnKMKDmd4pAUAOJ59Y2Jo3ED2Z5qKQf6HLHovMxq7Beb9CLPUe"
    crossorigin="anonymous"
    size="300"
    alpha="0.6"
    zindex="-1"
    defer
></script>


    </body>
</html>
