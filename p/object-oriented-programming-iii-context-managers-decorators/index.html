<!DOCTYPE html>
<html lang="en-us" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='Intro Docstrings Docstrings, which describes what the arguments are supposed to be, and what it returns, makes code much easier to use, read, and maintain. A docstring is a string enclosed in triple quotes and written as the first line of a function.
1 2 3 4 5  def func() &amp;#34;&amp;#34;&amp;#34; docstring &amp;#34;&amp;#34;&amp;#34; pass   Every docstring has some (although usually not all) of these five key pieces of information:'><title>Object Oriented Programming III (Context Managers &amp; Decorators)</title>

<link rel='canonical' href='https://wanghaoming177.netlify.app/p/object-oriented-programming-iii-context-managers-decorators/'>

<link rel="stylesheet" href="/scss/style.min.6cb794b99473add9625fc6fcb4fd8782c21b06365b632b8fbb1076efe11c688e.css"><meta property='og:title' content='Object Oriented Programming III (Context Managers &amp; Decorators)'>
<meta property='og:description' content='Intro Docstrings Docstrings, which describes what the arguments are supposed to be, and what it returns, makes code much easier to use, read, and maintain. A docstring is a string enclosed in triple quotes and written as the first line of a function.
1 2 3 4 5  def func() &amp;#34;&amp;#34;&amp;#34; docstring &amp;#34;&amp;#34;&amp;#34; pass   Every docstring has some (although usually not all) of these five key pieces of information:'>
<meta property='og:url' content='https://wanghaoming177.netlify.app/p/object-oriented-programming-iii-context-managers-decorators/'>
<meta property='og:site_name' content='Haoming Wang'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='Object Oriented Programming' /><meta property='article:published_time' content='2019-08-19T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2019-08-19T00:00:00&#43;00:00'/><meta property='og:image' content='https://wanghaoming177.netlify.app/head_img/oop_hi/oo3.png' />
<meta name="twitter:title" content="Object Oriented Programming III (Context Managers &amp; Decorators)">
<meta name="twitter:description" content="Intro Docstrings Docstrings, which describes what the arguments are supposed to be, and what it returns, makes code much easier to use, read, and maintain. A docstring is a string enclosed in triple quotes and written as the first line of a function.
1 2 3 4 5  def func() &amp;#34;&amp;#34;&amp;#34; docstring &amp;#34;&amp;#34;&amp;#34; pass   Every docstring has some (although usually not all) of these five key pieces of information:"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://wanghaoming177.netlify.app/head_img/oop_hi/oo3.png' />
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "dark");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/IMG_0770_hu86b91b9497cdda82d5c488540c7342b2_101927_300x0_resize_q75_box.jpg" width="300"
                            height="273" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">üåè</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">Haoming Wang</a></h1>
            <h2 class="site-description">We choose to go to the moon in this decade and do the other things, not because they are easy, but because they are hard.</h2>
        </div>
    </header><ol class="social-menu">
            
                <li>
                    <a 
                        href='https://github.com/floating15'
                        target="_blank"
                        title="GitHub"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://twitter.com'
                        target="_blank"
                        title="Linkedin"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-linkedin" width="28" height="28" viewBox="0 0 24 24" stroke-width="1.5" stroke="#9e9e9e" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <rect x="4" y="4" width="16" height="16" rx="2" />
  <line x1="8" y1="11" x2="8" y2="16" />
  <line x1="8" y1="8" x2="8" y2="8.01" />
  <line x1="12" y1="16" x2="12" y2="11" />
  <path d="M16 16v-3a2 2 0 0 0 -4 0" />
</svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://follow.it/haoming-wang?action=followPub'
                        target="_blank"
                        title="r-mail"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-mailbox" width="28" height="28" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M10 21v-6.5a3.5 3.5 0 0 0 -7 0v6.5h18v-6a4 4 0 0 0 -4 -4h-10.5" />
  <path d="M12 11v-8h4l2 2l-2 2h-4" />
  <path d="M6 15h1" />
</svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://twitter.com'
                        target="_blank"
                        title="Twitter"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        

        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="#FF1C02" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        

        <li >
            <a href='/about/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="#35FF02" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>About</span>
            </a>
        </li>
        
        

        <li >
            <a href='/notes/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-math-function" width="28" height="28" viewBox="0 0 24 24" stroke-width="1.5" stroke="#02EAFF" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M14 10h1c1 0 1 1 2.016 3.527c.984 2.473 .984 3.473 1.984 3.473h1" />
  <path d="M13 17c1.5 0 3 -2 4 -3.5s2.5 -3.5 4 -3.5" />
  <path d="M3 19c0 1.5 .5 2 2 2s2 -4 3 -9s1.5 -9 3 -9s2 .5 2 2" />
  <line x1="5" y1="12" x2="11" y2="12" />
</svg>
                
                <span>Notes</span>
            </a>
        </li>
        
        

        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="#0223FF" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        

        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="#F402FF" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        

        <li >
            <a href='/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        

        <div class="menu-bottom-section">
            
            
                <li id="dark-mode-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <span>Dark Mode</span>
                </li>
            
        </div>
    </ol>
</aside>
<main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/p/object-oriented-programming-iii-context-managers-decorators/">
                
                    <img src="/head_img/oop_hi/oo3.png" loading="lazy" alt="Featured image of post Object Oriented Programming III (Context Managers &amp; Decorators)" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/python/" style="background-color: false; color: false;">
                Python
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/object-oriented-programming-iii-context-managers-decorators/">Object Oriented Programming III (Context Managers &amp; Decorators)</a>
        </h2>
    
        
    </div>

    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Aug 19, 2019</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    45 minute read
                </time>
            </div>
        
    </footer>
    

    
</div>
</header>

    <section class="article-content">
    
    
    <h1 id="intro">Intro</h1>
<h2 id="docstrings">Docstrings</h2>
<p>Docstrings, which describes what the arguments are supposed to be, and what it returns, makes code much easier to use, read, and maintain. A docstring is a string enclosed in triple quotes and written as the first line of a function.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">def</span> <span class="nf">func</span><span class="p">()</span>
    <span class="s2">&#34;&#34;&#34;
</span><span class="s2">    docstring
</span><span class="s2">    &#34;&#34;&#34;</span>
    <span class="k">pass</span>
</code></pre></td></tr></table>
</div>
</div><p>Every docstring has some (although usually not all) of these five key pieces of information:</p>
<ul>
<li>what the function does</li>
<li>what the arguments are</li>
<li>what the return value or values should be</li>
<li>info about any errors raised,</li>
<li>anything else you&rsquo;d like to say about the function.</li>
</ul>
<p>Python community has evolved several standards for how to format your docstrings. <a class="link" href="https://sphinxcontrib-napoleon.readthedocs.io/en/latest/example_google.html"  target="_blank" rel="noopener"
    >Google-style</a> and <code>Numpydoc</code> are the most popular formats, so we&rsquo;ll focus on those.</p>
<p>In Google style, the docstring starts with a <strong>concise description of what the function does. This should be in imperative language</strong>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">def</span> <span class="nf">count_letter</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">letter</span><span class="p">):</span>
	<span class="s2">&#34;&#34;&#34;
</span><span class="s2">	Count the number of times `letter` appears in `content`
</span><span class="s2">	&#34;&#34;&#34;</span>
	<span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">letter</span><span class="p">,</span> <span class="nb">str</span><span class="p">))</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">letter</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
	<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;`letter` must be a single character string.&#39;</span><span class="p">)</span>
	<span class="k">return</span> <span class="nb">len</span><span class="p">([</span><span class="n">char</span> <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">content</span> <span class="k">if</span> <span class="n">char</span> <span class="o">==</span> <span class="n">letter</span><span class="p">])</span>
</code></pre></td></tr></table>
</div>
</div><p>Next comes the &ldquo;<code>Args</code>&rdquo; section where you list each argument <strong>name</strong>, followed by its expected <strong>type</strong> in parentheses, and then what its <strong>role</strong> is in the function. If you need extra space, you can break to the next line and indent. If an argument has a <strong>default value</strong>, mark it as &ldquo;<code>optional</code>&rdquo; when describing the type. If the function does not take any parameters, feel free to leave this section out.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">def</span> <span class="nf">count_letter</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">letter</span><span class="p">):</span>
  <span class="s2">&#34;&#34;&#34;Count the number of times `letter` appears in `content`.
</span><span class="s2">
</span><span class="s2">    Args:
</span><span class="s2">    	content (str): The string to search.
</span><span class="s2">    	letter (str): The letter to search for.
</span><span class="s2">  &#34;&#34;&#34;</span>
  <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">letter</span><span class="p">,</span> <span class="nb">str</span><span class="p">))</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">letter</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;`letter` must be a single character string.&#39;</span><span class="p">)</span>
  <span class="k">return</span> <span class="nb">len</span><span class="p">([</span><span class="n">char</span> <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">content</span> <span class="k">if</span> <span class="n">char</span> <span class="o">==</span> <span class="n">letter</span><span class="p">])</span>
</code></pre></td></tr></table>
</div>
</div><p>The next section is the &ldquo;<code>Returns</code>&rdquo; section, where you list the expected <strong>type</strong> or types of what gets returned. You can also provide some comment about what gets returned, but often the name of the function and the description will make this clear. Finally, if your function intentionally raises any errors, you should add a &ldquo;<code>Raises</code>&rdquo; section. You can also include any additional notes or examples of usage in free form text at the end.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">def</span> <span class="nf">count_letter</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">letter</span><span class="p">):</span>
	<span class="s2">&#34;&#34;&#34;Count the number of times `letter` appears in `content`.
</span><span class="s2">
</span><span class="s2">	Args:
</span><span class="s2">		content (str): The string to search.
</span><span class="s2">		letter (str): The letter to search for.
</span><span class="s2">
</span><span class="s2">	Returns:
</span><span class="s2">		int
</span><span class="s2">
</span><span class="s2">	Raises:
</span><span class="s2">		ValueError: If `letter` is not a one-character string.
</span><span class="s2">	&#34;&#34;&#34;</span>
	<span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">letter</span><span class="p">,</span> <span class="nb">str</span><span class="p">))</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">letter</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
	<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;`letter` must be a single character string.&#39;</span><span class="p">)</span>
	<span class="k">return</span> <span class="nb">len</span><span class="p">([</span><span class="n">char</span> <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">content</span> <span class="k">if</span> <span class="n">char</span> <span class="o">==</span> <span class="n">letter</span><span class="p">])</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>Personally, I think the Numpydoc format looks better than the Google style.</p>
</blockquote>
<p>you can access the contents of your function&rsquo;s docstring using  <code>__doc__</code> attribute. Notice that the <code>__doc__</code> attribute contains the raw docstring, including any tabs or spaces.</p>
<p>To remove those leading spaces, you can use the <code>getdoc()</code> function from the <code>inspect</code> module. The inspect module contains a lot of useful methods for gathering information about functions.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="kn">import</span> <span class="nn">inspect</span>

<span class="k">def</span> <span class="nf">build_tooltip</span><span class="p">(</span><span class="n">function</span><span class="p">):</span>
	<span class="s2">&#34;&#34;&#34;Create a tooltip for any function that shows the
</span><span class="s2">	function&#39;s docstring.
</span><span class="s2">
</span><span class="s2">	Args:
</span><span class="s2">		function (callable): The function we want a tooltip for.
</span><span class="s2">
</span><span class="s2">	Returns:
</span><span class="s2">		str
</span><span class="s2">	&#34;&#34;&#34;</span>
	<span class="n">docstring</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getdoc</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
	<span class="n">border</span> <span class="o">=</span> <span class="s1">&#39;#&#39;</span> <span class="o">*</span> <span class="mi">28</span>
	<span class="k">return</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="se">\n</span><span class="si">{}</span><span class="se">\n</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">border</span><span class="p">,</span> <span class="n">docstring</span><span class="p">,</span> <span class="n">border</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">build_tooltip</span><span class="p">(</span><span class="n">count_letter</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">build_tooltip</span><span class="p">(</span><span class="nb">range</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">build_tooltip</span><span class="p">(</span><span class="nb">print</span><span class="p">))</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>############################
Count the number of times `letter` appears in `content`.

Args:
	content (str): The string to search.
	letter (str): The letter to search for.

Returns:
	int

Raises:
	ValueError: If `letter` is not a one-character string.
############################
############################
range(stop) -&gt; range object
range(start, stop[, step]) -&gt; range object

Return an object that produces a sequence of integers from start (inclusive)
to stop (exclusive) by step.  range(i, j) produces i, i+1, i+2, ..., j-1.
start defaults to 0, and stop is omitted!  range(4) produces 0, 1, 2, 3.
These are exactly the valid indices for a list of 4 elements.
When step is given, it specifies the increment (or decrement).
############################
############################
print(value, ..., sep=' ', end='\n', file=sys.stdout, flush=False)

Prints the values to a stream, or to sys.stdout by default.
Optional keyword arguments:
file:  a file-like object (stream); defaults to the current sys.stdout.
sep:   string inserted between values, default a space.
end:   string appended after the last value, default a newline.
flush: whether to forcibly flush the stream.
############################
</code></pre><h2 id="dry--do-one-thing">DRY &amp; Do one thing</h2>
<p>DRY (also known as &ldquo;don&rsquo;t repeat yourself&rdquo;) and the &ldquo;Do One Thing&rdquo; principle are good ways to ensure that functions are well designed and easy to test.</p>
<p>When you are writing code to look for answers to a research question, it is totally normal to copy and paste a bit of code, tweak it slightly, and return it. But it can lead to real problems. For instance, it is easy to accidentally introduce errors that are hard to spot. Another problem is that if you want to change something, you often have to do it in multiple places.</p>
<p><strong>Wrapping the repeated logic in a function and then calling that function several times</strong> makes it much easier to avoid the kind of errors introduced by copying and pasting. And if you ever need to change something, you only have to do it in one or two places.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">def</span> <span class="nf">standardize</span><span class="p">(</span><span class="n">column</span><span class="p">):</span>
    <span class="s2">&#34;&#34;&#34;Standardize the values in a column.
</span><span class="s2">
</span><span class="s2">    Args:
</span><span class="s2">        column (pandas Series): The data to standardize.
</span><span class="s2">
</span><span class="s2">    Returns:
</span><span class="s2">        pandas Series: the values as z-scores
</span><span class="s2">    &#34;&#34;&#34;</span>
    <span class="n">z_score</span> <span class="o">=</span> <span class="p">(</span><span class="n">column</span> <span class="o">-</span> <span class="n">column</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span> <span class="o">/</span> <span class="n">column</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">z_score</span>

<span class="n">df</span><span class="p">[</span><span class="s1">&#39;y1_z&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">standardize</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">y1_gpa</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;y2_z&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">standardize</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">y2_gpa</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;y3_z&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">standardize</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">y3_gpa</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;y4_z&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">standardize</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">y4_gpa</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>Another software engineering principle: Do One Thing. <strong>Every function should have a single responsibility</strong>. Instead of one big function, we could have a more nimble function. We get several advantages from splitting the big function into smaller functions. First of all, our code has become more flexible. The code will also be easier for other developers to understand, and it will be more pleasant to test and debug. Finally, if you ever need to update your code, functions that each have a single responsibility make it easier to predict how changes in one place will affect the rest of the code.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="c1"># split it into two simpler functions: mean() and median()</span>

<span class="k">def</span> <span class="nf">mean_and_median</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
  <span class="s2">&#34;&#34;&#34;Get the mean and median of a sorted list of `values`
</span><span class="s2">
</span><span class="s2">    Args:
</span><span class="s2">    	values (iterable of float): A list of numbers
</span><span class="s2">
</span><span class="s2">    Returns:
</span><span class="s2">    	tuple (float, float): The mean and median
</span><span class="s2">    &#34;&#34;&#34;</span>
	<span class="n">mean</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
	<span class="n">midpoint</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">median</span> <span class="o">=</span> <span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">midpoint</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">values</span><span class="p">[</span><span class="n">midpoint</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">median</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">midpoint</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">mean</span><span class="p">,</span> <span class="n">median</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="c1"># function mean()</span>
<span class="k">def</span> <span class="nf">mean</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
    <span class="s2">&#34;&#34;&#34;Get the mean of a sorted list of values
</span><span class="s2">
</span><span class="s2">    Args:
</span><span class="s2">    	values (iterable of float): A list of numbers
</span><span class="s2">
</span><span class="s2">    Returns:
</span><span class="s2">    	float
</span><span class="s2">    &#34;&#34;&#34;</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">values</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mean</span>

<span class="c1"># function median()</span>

<span class="k">def</span> <span class="nf">median</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
	<span class="s2">&#34;&#34;&#34;Get the median of a sorted list of values
</span><span class="s2">
</span><span class="s2">	Args:
</span><span class="s2">		values (iterable of float): A list of numbers
</span><span class="s2">
</span><span class="s2">	Returns:
</span><span class="s2">		float
</span><span class="s2">	&#34;&#34;&#34;</span>
	<span class="n">midpoint</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
	<span class="n">median</span> <span class="o">=</span> <span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">midpoint</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">values</span><span class="p">[</span><span class="n">midpoint</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">median</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">midpoint</span><span class="p">]</span>
	<span class="k">return</span> <span class="n">median</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="pass-by-assignment">Pass by assignment</h2>
<p>The way that Python passes information to functions is called &ldquo;pass by assignment&rdquo;.</p>
<p>Consider function <code>foo()</code> that takes a list and sets the first value of the list to 99. Then we set &ldquo;<code>my_list</code>&rdquo; to the value [1, 2, 3] and pass it to <code>foo()</code>. The value of &ldquo;<code>my_list</code>&rdquo; would be [99, 2, 3] after calling <code>foo()</code>. Lists in Python are <strong>mutable objects</strong>, meaning that they can be changed.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">99</span>
<span class="n">my_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">foo</span><span class="p">(</span><span class="n">my_list</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">my_list</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>[99, 2, 3]
</code></pre><p>Consider function <code>bar()</code> that takes an argument and adds 90 to it. Then we assign the value 3 to the variable &ldquo;<code>my_var</code>&rdquo; and call <code>bar()</code> with &ldquo;<code>my_var</code>&rdquo; as the argument. The value of &ldquo;<code>my_var</code>&rdquo; would be 3 after we&rsquo;ve called <code>bar()</code>. In Python, integers are <strong>immutable objects</strong>, meaning they can&rsquo;t be changed.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">def</span> <span class="nf">bar</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">90</span>
<span class="n">my_var</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">bar</span><span class="p">(</span><span class="n">my_var</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">my_var</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>3
</code></pre><p>Imagine that this gray bar is the computer&rsquo;s memory. When we set the variable &ldquo;<code>a</code>&rdquo; equal to the list [1, 2, 3], the Python interpreter makes &lsquo;<code>a</code>&rsquo; points to this location in memory. Then if we type &ldquo;<code>b = a</code>&rdquo;, the interpreter makes &lsquo;<code>b</code>&rsquo; points to whatever &lsquo;<code>a</code>&rsquo; is pointing to. (certainly, &lsquo;<code>a</code>&rsquo; points to whatever &lsquo;<code>b</code>&rsquo; is pointing to correspondingly.)</p>
<p><img src="https://raw.githubusercontent.com/floating15/img/main/202204061529278.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>If we append 4 to the end of &ldquo;<code>a</code>&rdquo;, both variables get it because there is only one list. Likewise, if we append 5 to &ldquo;<code>b</code>&rdquo;, both variables get it.</p>
<p><img src="https://raw.githubusercontent.com/floating15/img/main/202204061532873.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>However, if we assign &ldquo;<code>a</code>&rdquo; to a different object (like <code>int</code>) in memory, that does not change where &ldquo;<code>b</code>&rdquo; is pointing. Now, things that happen to &ldquo;<code>a</code>&rdquo; are no longer happening to &ldquo;<code>b</code>&rdquo;, and vice versa.</p>
<p>When we assign a list to the variable &ldquo;<code>my_list</code>&rdquo;, it sets up a location in memory for it. Then, when we pass &ldquo;<code>my_list</code>&rdquo; to the function <code>foo()</code>, the parameter &ldquo;<code>x</code>&rdquo; gets assigned to that same location. So when the function modifies the thing that &ldquo;<code>x</code>&rdquo; points to, it is also modifying the thing that &ldquo;<code>my_list</code>&rdquo; points to.</p>
<p>In the other example, we created a variable &ldquo;<code>my_var</code>&rdquo; and assigned it the value 3. Then we passed it to the function <code>bar()</code>, which caused the argument &ldquo;<code>x</code>&rdquo; to point to the same place &ldquo;<code>my_var</code>&rdquo; is pointing. <strong>But the <code>bar()</code> function assigns &ldquo;<code>x</code>&rdquo; to a new value</strong> , so the &ldquo;<code>my_var</code>&rdquo; variable isn&rsquo;t touched. In fact, there is no way in Python to have changed &ldquo;x&rdquo; or &ldquo;<code>my_var</code>&rdquo; directly, because integers are <strong>immutable variables</strong>.</p>
<blockquote>
<p>You can comprehend it as: Python interpreter kills the old <code>x</code>, and release the relationship between <code>x</code> and <code>my_var</code>, and then create a new object <code>x</code> which has nothing to do with <code>my_var</code>.</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">def</span> <span class="nf">store_lower</span><span class="p">(</span><span class="n">_dict</span><span class="p">,</span> <span class="n">_string</span><span class="p">):</span>  <span class="c1"># &lt;-- d &amp; (associates with) _dict; s &amp; _string</span>
  <span class="s2">&#34;&#34;&#34;Add a mapping between `_string` and a lowercased version of `_string` to `_dict`
</span><span class="s2">
</span><span class="s2">  Args:
</span><span class="s2">    _dict (dict): The dictionary to update.
</span><span class="s2">    _string (str): The string to add.
</span><span class="s2">  &#34;&#34;&#34;</span>
  <span class="n">orig_string</span> <span class="o">=</span> <span class="n">_string</span> <span class="c1"># &lt;-- orig_string &amp; _string &amp; s </span>
  <span class="n">_string</span> <span class="o">=</span> <span class="n">_string</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="c1"># &lt;-- _string # (breaks up with) orig_string &amp; s</span>
  <span class="n">_dict</span><span class="p">[</span><span class="n">orig_string</span><span class="p">]</span> <span class="o">=</span> <span class="n">_string</span>

<span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;Hello&#39;</span>
<span class="n">store_lower</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">s</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>{'Hello': 'hello'} Hello
# {'orig_string': '_string'} s
</code></pre><p>There are only a few immutable data types in Python because almost everything is represented as an object. The only way to tell if something is mutable is to see if there is a function or method that will change the object without assigning it to a new variable.</p>
<p><img src="https://raw.githubusercontent.com/floating15/img/main/202204061543816.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>Notice, Consider <code>foo()</code> is a function that appends the value 1 to the end of a list with an empty list as a default value.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">var</span><span class="o">=</span><span class="p">[]):</span>
	<span class="n">var</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">var</span>
</code></pre></td></tr></table>
</div>
</div><p>When we call <code>foo()</code> the first time, we will get a list with one entry as expected. But, when we call <code>foo()</code> again, the default value has already been modified.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="n">foo</span><span class="p">()</span>
<span class="n">foo</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>[1]
[1, 1]
</code></pre><p>If you want a mutable variable as a default value, consider defaulting to <code>None</code> and setting the argument in the function.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">var</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
	<span class="k">if</span> <span class="n">var</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
		<span class="n">var</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="n">var</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">var</span>
<span class="n">foo</span><span class="p">()</span>
<span class="n">foo</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>[1]
[1]
</code></pre><p>I wan to explain exactly what&rsquo;s happening when we call a function with mutable object default value. Consider following example,</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">def</span> <span class="nf">addend</span><span class="p">(</span><span class="n">lt</span><span class="o">=</span><span class="p">[]):</span> <span class="c1"># 0.</span>
    <span class="n">lt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">lt</span>

<span class="n">lst</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="c1"># 1.</span>
<span class="nb">print</span><span class="p">(</span><span class="n">addend</span><span class="p">(</span><span class="n">lst</span><span class="p">))</span> <span class="c1"># 2.</span>
<span class="nb">print</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span> 
<span class="nb">print</span><span class="p">(</span><span class="n">addend</span><span class="p">())</span> <span class="c1"># 3.</span>
<span class="nb">print</span><span class="p">(</span><span class="n">addend</span><span class="p">())</span> <span class="c1"># 4.</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>[1, 2, 3, 4, 'end']
[1, 2, 3, 4, 'end']
['end']
['end', 'end']
</code></pre><ul>
<li>step 0: <code>def addend(lt=[]):</code>
As we define the function <code>append()</code>, Python interpreter assigns a memory space block, which stored an empty list, to argument <code>lt</code>. Notice, <code>lt</code> points to this block.</li>
<li>step 1: <code>lst = [1,2,3,4]</code>
We we define a global list object <code>lst</code>, Python interpreter assigns another memory, which stored a corresponding list, to variable <code>lst</code>. <code>lst</code> points to this block.</li>
<li>step 2: <code>print(addend(lst))</code>
When we call function <code>addend</code> with parameter <code>lst</code>, Python interpreter reads this global object in the local scope, and then makes pointer <code>lt</code> point to the block pointed by <code>lst</code>. Thus <code>lt</code>, <code>lst</code> point to the same memory block, which loaded list object <code>([1,2,3,4])</code>. And then <strong>interpreter appends a new element &ldquo;end&rdquo; to this block</strong>, which means it changes the value of <code>lt</code> and <code>lst</code> simultaneously. This is the reason why the outcome of <code>print(lst)</code> is <code>[1, 2, 3, 4, 'end']</code>.</li>
</ul>
<p><img src="https://raw.githubusercontent.com/floating15/img/main/202204071535716.png"
	
	
	
	loading="lazy"
	
	
></p>
<blockquote>
<p>Notice that if <code>lt</code>, <code>lst</code> is an immutable object, the python interpreter will kill the older <code>lt</code> pointer, and assigns a new memory block to <code>lt</code>, instead of <strong>appending</strong> the element to the memory block. Thus it will not modify the value of <code>lst</code>. Collectively,</p>
<ul>
<li>immutable object: change the space pointed by variable.</li>
<li>mutable object: change the value of space pointed by variable.</li>
</ul>
</blockquote>
<ul>
<li>step 3/4: <code>print(addend())</code>
When we call <code>addend()</code> without parameter, the Python interpreter will add an element &ldquo;end&rdquo; to the space pointed by <code>lt</code>; when we call <code>addend()</code> again, the space pointed by <code>lt</code> has already been changed.</li>
</ul>
<p><img src="https://raw.githubusercontent.com/floating15/img/main/202204071555945.png"
	
	
	
	loading="lazy"
	
	
>
Above example is adapted from <a class="link" href="https://blog.csdn.net/weixin_42007999/article/details/106879038?spm=1001.2101.3001.6650.3&amp;utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-3.pc_relevant_antiscanv2&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-3.pc_relevant_antiscanv2&amp;utm_relevant_index=6"  target="_blank" rel="noopener"
    >link</a>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="c1"># Modify this func using an immutable variable for the default argument.</span>

<span class="k">def</span> <span class="nf">add_column</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()):</span>
	<span class="s2">&#34;&#34;&#34;Add a column of `values` to a DataFrame `df`.
</span><span class="s2">
</span><span class="s2">	The column will be named &#34;col_&lt;n&gt;&#34; where &#34;n&#34; is 
</span><span class="s2">	the numerical index of the column.
</span><span class="s2">
</span><span class="s2">    Args:
</span><span class="s2">    	values (iterable): The values of the new column
</span><span class="s2">    	df (DataFrame, optional): The DataFrame to update.
</span><span class="s2">    		If no DataFrame is passed, one is created by default.
</span><span class="s2">
</span><span class="s2">    Returns:
</span><span class="s2">    	DataFrame
</span><span class="s2">    &#34;&#34;&#34;</span>
  	<span class="n">df</span><span class="p">[</span><span class="s1">&#39;col_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">))]</span> <span class="o">=</span> <span class="n">values</span>
  	<span class="k">return</span> <span class="n">df</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">def</span> <span class="nf">better_add_column</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
	<span class="s2">&#34;&#34;&#34;Add a column of `values` to a DataFrame `df`.
</span><span class="s2">
</span><span class="s2">	The column will be named &#34;col_&lt;n&gt;&#34; where &#34;n&#34; is 
</span><span class="s2">	the numerical index of the column.
</span><span class="s2">
</span><span class="s2">    Args:
</span><span class="s2">    	values (iterable): The values of the new column
</span><span class="s2">    	df (DataFrame, optional): The DataFrame to update.
</span><span class="s2">    		If no DataFrame is passed, one is created by default.
</span><span class="s2">
</span><span class="s2">    Returns:
</span><span class="s2">    	DataFrame
</span><span class="s2">    &#34;&#34;&#34;</span>

	<span class="k">if</span> <span class="n">df</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    	<span class="n">df</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
  	<span class="n">df</span><span class="p">[</span><span class="s1">&#39;col_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">))]</span> <span class="o">=</span> <span class="n">values</span>
  	<span class="k">return</span> <span class="n">df</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="context-managers">Context Managers</h1>
<h2 id="using-context-managers">Using context managers</h2>
<p>A context manager is a type of function that</p>
<ul>
<li>sets up a context for code to run in,</li>
<li>runs your code,</li>
<li>and then removes the context.</li>
</ul>
<p>The &ldquo;<code>open()</code>&rdquo; function is a context manager. When you write &ldquo;<code>with open()</code>&rdquo;, it opens a file that you can read from or write to. Then, it gives control back to your code so that you can perform operations on the file object. When the code inside the indented block is done, the &ldquo;<code>open()</code>&rdquo; function makes sure that the file is closed before continuing on in the script.</p>
<p>Any time you use a context manager, it will look like this:</p>
<ol>
<li>The keyword &ldquo;<code>with</code>&rdquo; lets Python know that you are trying to enter a context. Then you call a function.</li>
<li>You can call any function that is built to work as a context manager. A context manager can take arguments like any normal function.</li>
<li>You end the &ldquo;<code>with</code>&rdquo; statement with a colon &lsquo;<code>:</code>&rsquo;, as if you were writing a for <code>loop</code> or an <code>if</code> statement.</li>
<li>Any code that you want to run inside the context that the context manager created needs to be indented.</li>
<li>When the indented block is done, the context manager gets a chance to clean up anything that it needs to, like when the &ldquo;<code>open()</code>&rdquo; context manager closed the file.</li>
</ol>
<p>Collectively:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">with</span> <span class="o">&lt;</span><span class="n">context</span><span class="o">-</span><span class="n">manager</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&lt;</span><span class="n">args</span><span class="o">&gt;</span><span class="p">):</span>
	<span class="o">&lt;</span><span class="n">code</span><span class="o">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>Statements in Python that have an indented block after them, like for <code>loops</code>, <code>if/else</code> statements, function/class definitions <code>def/Class</code>, etc. are called &ldquo;<strong>compound statements</strong>&rdquo;. The &ldquo;<code>with</code>&rdquo; statement is another type of compound statement.</p>
</blockquote>
<p>Some context managers want to return a value that you can use inside the context. By adding &ldquo;<code>as</code>&rdquo; and a variable name at the end of the &ldquo;<code>with</code>&rdquo; statement, you can assign the returned value to the variable name.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;alice.txt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
  <span class="n">text</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
  <span class="k">if</span> <span class="n">word</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;cat&#39;</span><span class="p">,</span> <span class="s1">&#39;cats&#39;</span><span class="p">]:</span>
    <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Lewis Carroll uses the word &#34;cat&#34; </span><span class="si">{}</span><span class="s1"> times&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>Lewis Carroll uses the word &quot;cat&quot; 24 times
</code></pre><h2 id="writing-context-managers">Writing context managers</h2>
<p>There are two ways to define a context manager in Python:</p>
<ul>
<li>by using a class that has special <code>__enter__()</code> and <code>__exit__()</code> methods</li>
<li>by decorating a certain kind of function.</li>
</ul>
<p>We will focus on the function-based method here. There are five parts to creating a context manager.</p>
<ol>
<li>define a function.</li>
<li>(optional) add any setup code your context needs.</li>
<li>use the &ldquo;<code>yield</code>&rdquo; keyword to signal to Python that this is a special kind of function.</li>
<li>(optional) add any teardown code that your context needs.</li>
<li>decorate the function on the line above your context manager function with <code>@contextlib.contextmanager</code>.</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="kn">import</span> <span class="nn">contextlib</span>
<span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
<span class="k">def</span> <span class="nf">context_</span><span class="err">`</span><span class="n">func</span><span class="p">()</span><span class="err">`</span><span class="p">:</span>
	<span class="c1"># setup code</span>
	<span class="k">yield</span> 
	<span class="c1"># teardown code</span>
</code></pre></td></tr></table>
</div>
</div><p>When you write <code>yield</code> keyword, it means that you are going to return a value, but you expect to finish the rest of the function at some point <strong>in the future</strong>. As we say last blog, the &ldquo;<code>yield</code>&rdquo; keyword as a thing that gets used when creating generators. In fact, <strong>a context manager function is technically a generator that yields a single value.</strong> The value that your context manager yields can be assigned to a variable in the &ldquo;<code>with</code>&rdquo; statement by adding &ldquo;<code>as &lt;variable name&gt;</code>&rdquo;.</p>
<p>Here, we&rsquo;ve assigned the value 42 that <code>my_context()</code> yields to the variable &ldquo;<code>foo</code>&rdquo;. By running this code, you can see that <strong>after the context block is done executing, the rest of the <code>my_context()</code> function gets run</strong>, printing &ldquo;goodbye&rdquo;.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="kn">import</span> <span class="nn">contextlib</span>
<span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
<span class="k">def</span> <span class="nf">my_context</span><span class="p">():</span>
	<span class="s2">&#34;&#34;&#34;Show the order of the execution of CM code.
</span><span class="s2">
</span><span class="s2">	Yield:
</span><span class="s2">		a certain value.
</span><span class="s2">
</span><span class="s2">	&#34;&#34;&#34;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;1&#34;</span><span class="p">)</span>
    <span class="k">yield</span> <span class="mi">34</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;2&#34;</span><span class="p">)</span>

<span class="k">with</span> <span class="n">my_context</span><span class="p">()</span> <span class="k">as</span> <span class="n">foo</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>1
34
2
</code></pre><p>This context manager is an example of code that accesses a database. Like most context managers, it has some <strong>setup code</strong> that runs <strong>before</strong> the function <strong>yields</strong>. This context manager uses that setup code to connect to the database. Most context managers also have some <strong>teardown</strong> or cleanup code when they get control back <strong>after</strong> yielding.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
<span class="k">def</span> <span class="nf">database</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
	<span class="s2">&#34;&#34;&#34;Connect to a database and close the connection 
</span><span class="s2">	after query.
</span><span class="s2">
</span><span class="s2">	Yield:
</span><span class="s2">		connection object
</span><span class="s2">	&#34;&#34;&#34;</span>
	<span class="n">db</span> <span class="o">=</span> <span class="n">postgres</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
	<span class="k">yield</span> <span class="n">db</span>
	<span class="n">db</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;https://xxxx&#34;</span>
<span class="k">with</span> <span class="n">database</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">d</span><span class="p">:</span>
	<span class="n">outcome</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&#34;select * from table&#34;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>This setup/teardown behavior allows a context manager to <strong>hide things like connecting and disconnecting from a database</strong> so that a programmer using the context manager can just perform operations on the database without worrying about the underlying details.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
<span class="k">def</span> <span class="nf">open_read_only</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
	<span class="s2">&#34;&#34;&#34;Open a file in read-only mode.
</span><span class="s2">
</span><span class="s2">	Args:
</span><span class="s2">		filename (str): The location of the file to read.
</span><span class="s2">
</span><span class="s2">	Yields:
</span><span class="s2">		str: the content of the opened file object.
</span><span class="s2">	&#34;&#34;&#34;</span>
	<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
	<span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
	<span class="k">yield</span> <span class="n">content</span>
	<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">with</span> <span class="n">open_read_only</span><span class="p">(</span><span class="s1">&#39;my_file.txt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">content</span><span class="p">:</span>
	<span class="nb">print</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>Congratulations! You wrote a context manager that acts like `open()` but responses the content of the file directly without `read()` method.
</code></pre><p>The <code>database()</code> context manager that we&rsquo;ve been looking at <strong>yields a specific value</strong> - the database connection - that can be used in the context block. Some context managers <strong>don&rsquo;t yield an explicit value</strong>. <code>in_dir()</code> is a context manager that changes the current working directory to a specific path and then changes it back after the context block is done. It does not need to return anything with its &ldquo;<code>yield</code>&rdquo; statement.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="kn">import</span> <span class="nn">os</span>
<span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
<span class="k">def</span> <span class="nf">in_dir</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&#34;../&#34;</span><span class="p">):</span>
	<span class="s2">&#34;&#34;&#34;changes the current working directory to 
</span><span class="s2">	a specific path and then changes it back after 
</span><span class="s2">	the context block is done.
</span><span class="s2">
</span><span class="s2">	Yield:
</span><span class="s2">		None
</span><span class="s2">	&#34;&#34;&#34;</span>
    <span class="n">old_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">yield</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">old_dir</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>

<span class="k">with</span> <span class="n">in_dir</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">())</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>/Users/wanghaoming/PycharmProjects/daliy_test/save
/Users/wanghaoming/PycharmProjects/daliy_test
['testpdf1.pdf', 'skl.ipynb', 'testpdf.pdf', 'pdf.ipynb', 'save', '.idea']
/Users/wanghaoming/PycharmProjects/daliy_test/save
</code></pre><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
<span class="k">def</span> <span class="nf">timer</span><span class="p">():</span>
	<span class="s2">&#34;&#34;&#34;Time the execution of a context block.
</span><span class="s2">
</span><span class="s2">	Yields:
</span><span class="s2">	None
</span><span class="s2">	&#34;&#34;&#34;</span>
	<span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
	<span class="k">yield</span>
	<span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
	<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Elapsed: </span><span class="si">{:.2f}</span><span class="s1">s&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">))</span>

<span class="k">with</span> <span class="n">timer</span><span class="p">():</span>
	<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;This should take approximately 0.25 seconds&#39;</span><span class="p">)</span>
	<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>This should take approximately 0.25 seconds
Elapsed: 0.25s
</code></pre><h2 id="advanced-topics">Advanced topics</h2>
<h3 id="nested-contexts">Nested contexts</h3>
<p>Imagine you are implementing this <code>copy()</code> function that copies the contents of one file to another file. One way you could write this function would be to open the source file, store the contents of the file in the &ldquo;contents&rdquo; variable, then open the destination file and write the contents to it. This approach works fine until you try to copy a file that is too large to fit in memory.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
	<span class="s2">&#34;&#34;&#34;Copy the contents of one file to another.
</span><span class="s2">
</span><span class="s2">	Args:
</span><span class="s2">		src (str): File name of the file to be copied. 
</span><span class="s2">		dst (str): Where to write the new file.
</span><span class="s2">	&#34;&#34;&#34;</span> 
	<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">src</span><span class="p">,</span><span class="s2">&#34;r&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f_src</span><span class="p">:</span>
		<span class="n">contents</span> <span class="o">=</span> <span class="n">f_src</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
	<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span><span class="s2">&#34;w&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f_dst</span><span class="p">:</span>
		<span class="n">f_dst</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>A good ideal is that we could open both files at once and copy over one line at a time. The file object that the &ldquo;<code>open()</code>&rdquo; context manager returns can be <strong>iterated</strong> over in a for loop. In Python, <strong>nested &ldquo;<code>with</code>&quot;</strong> statements are perfectly legal.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
	<span class="s2">&#34;&#34;&#34;Copy the contents of one file to another.
</span><span class="s2">
</span><span class="s2">	Args:
</span><span class="s2">		src (str): File name of the file to be copied. 
</span><span class="s2">		dst (str): Where to write the new file.
</span><span class="s2">	&#34;&#34;&#34;</span> 
	<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">src</span><span class="p">,</span><span class="s2">&#34;r&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f_src</span><span class="p">:</span>
		<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span><span class="s2">&#34;w&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f_dst</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f_src</span><span class="p">:</span>
				<span class="n">f_dst</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p><img src="https://raw.githubusercontent.com/floating15/img/main/202204062323581.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>The context manager <code>stock('NVDA')</code> will connect to the NASDAQ and return an object that you can use to get the latest price by calling its <code>.price()</code> method. We now connect to <code>stock('NVDA')</code> and record 10 timesteps of price data by writing it to the file <code>NVDA.txt</code>. Notice that the object returned by <code>stock()</code> would be very large, thus we use nested context manager:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">with</span> <span class="n">stock</span><span class="p">(</span><span class="s2">&#34;NVDA&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">nvda</span><span class="p">:</span>
  	<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;NVDA.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f_out</span><span class="p">:</span>
    	<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
			<span class="n">value</span> <span class="o">=</span> <span class="n">nvda</span><span class="o">.</span><span class="n">price</span><span class="p">()</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Logging $</span><span class="si">{:.2f}</span><span class="s1"> for NVDA&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
			<span class="n">f_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:.2f}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>Opening stock ticker for NVDA
Logging $139.50 for NVDA
Logging $139.54 for NVDA
Logging $139.61 for NVDA
Logging $139.65 for NVDA
Logging $139.72 for NVDA
Logging $139.73 for NVDA
Logging $139.80 for NVDA
Logging $139.78 for NVDA
Logging $139.73 for NVDA
Logging $139.64 for NVDA
Closing stock ticker
</code></pre><h3 id="handling-errors">Handling errors</h3>
<p>If the programmer who uses your context manager writes code that causes an error after setup code but before teardown code, then the file or connection would not be close.</p>
<p><img src="https://raw.githubusercontent.com/floating15/img/main/202204062335777.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>To cope with an error, you may be familiar with the &ldquo;<code>try</code>&rdquo; statement. It allows you to write code that might raise an error inside the &ldquo;<code>try</code>&rdquo; block and catch that error inside the &ldquo;<code>except</code>&rdquo; block. You can choose to ignore the error or re-raise it. The &ldquo;<code>try</code>&rdquo; statement also allows you to add a &ldquo;<code>finally</code>&rdquo; block. This is code that runs no matter what an exception occurred or not.</p>
<p><img src="https://raw.githubusercontent.com/floating15/img/main/202204062337866.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>The solution is to put a &ldquo;<code>try</code>&rdquo; statement before the &ldquo;<code>yield</code>&rdquo; statement in our context manager function and a &ldquo;<code>finally</code>&rdquo; statement before teardown code.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">def</span> <span class="nf">in_dir</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
	<span class="s2">&#34;&#34;&#34;Change current working directory to `directory`,
</span><span class="s2">	allow the user to run some code, and change back.
</span><span class="s2">
</span><span class="s2">	Args:
</span><span class="s2">		directory (str): The path to a directory to work in.
</span><span class="s2">	&#34;&#34;&#34;</span>
	<span class="n">current_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
	<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>

	<span class="k">try</span><span class="p">:</span>
		<span class="k">yield</span>
	<span class="k">finally</span><span class="p">:</span>
		<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">current_dir</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>If you notice that your code is following any of these patterns, you might consider using a context manager.</p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>setup</th>
<th>teardown</th>
</tr>
</thead>
<tbody>
<tr>
<td>open</td>
<td>close</td>
</tr>
<tr>
<td>lock</td>
<td>release</td>
</tr>
<tr>
<td>change</td>
<td>reset</td>
</tr>
<tr>
<td>enter</td>
<td>exit</td>
</tr>
<tr>
<td>start</td>
<td>stop</td>
</tr>
<tr>
<td>setup</td>
<td>teardown</td>
</tr>
<tr>
<td>connect</td>
<td>disconnect</td>
</tr>
<tr>
<td>Adapted from Dave Brondsema&rsquo;s <a class="link" href="https://youtu.be/cSbD5SKwak0?t=795"  target="_blank" rel="noopener"
    >talk</a> at PyCon 2012.</td>
<td></td>
</tr>
</tbody>
</table></div>
<h1 id="decorators">Decorators</h1>
<h2 id="functions-are-objects">Functions are objects</h2>
<p>Functions are just like any other object in Python. They are not fundamentally different from lists, dictionaries, DataFrames, strings, integers, floats, modules, or anything else in Python. And because functions are just another type of object, you can do anything to or with them that you would do with any other kind of object.</p>
<p>You can take a function and assign it to a variable, like assign the <code>print()</code> function to <code>p</code>, and use it as your <code>print()</code> function.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="n">p</span> <span class="o">=</span> <span class="nb">print</span>
<span class="n">p</span><span class="p">(</span><span class="s2">&#34;test&#34;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>test
</code></pre><p>You can also add functions to a list or dictionary. Here, we&rsquo;ve added the functions <code>my_function()</code>, <code>open()</code>, and <code>print()</code> to the list &ldquo;<code>list_of_functions</code>&rdquo;. Below that, we&rsquo;ve added the same three functions to a dictionary <code>dict_of_functions</code>, under the keys &ldquo;<code>func1</code>&rdquo;, &ldquo;<code>func2</code>&rdquo;, and &ldquo;<code>func3</code>&rdquo;. We can call the element of the list or reference values of the dictionary and use them as if we were calling the functions directly.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">def</span> <span class="nf">my_function</span><span class="p">():</span>
    <span class="k">return</span> <span class="mi">42</span>

<span class="n">list_of_functions</span> <span class="o">=</span> <span class="p">[</span><span class="n">my_function</span><span class="p">,</span> <span class="nb">open</span><span class="p">,</span> <span class="nb">print</span><span class="p">]</span>
<span class="n">dict_of_functions</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&#34;func1&#34;</span><span class="p">:</span> <span class="n">my_function</span><span class="p">,</span>
    <span class="s2">&#34;func2&#34;</span><span class="p">:</span> <span class="nb">open</span><span class="p">,</span>
    <span class="s2">&#34;func3&#34;</span><span class="p">:</span> <span class="nb">print</span>
<span class="p">}</span>
<span class="n">dict_of_functions</span><span class="p">[</span><span class="s2">&#34;func3&#34;</span><span class="p">](</span><span class="n">list_of_functions</span><span class="p">[</span><span class="mi">0</span><span class="p">]())</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>42
</code></pre><p>Notice that when you assign a function to a variable, you <strong>do not include the parentheses</strong> after the function name. This is a subtle but very important distinction. When you type <code>my_function()</code> with the parentheses, you are calling that function. <strong>It evaluates to the value that the function returns</strong>. However, when you type &ldquo;<code>my_function</code>&rdquo; without the parentheses, you are referencing the function itself. <strong>It evaluates to a function object.</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="nb">print</span><span class="p">(</span><span class="n">my_function</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">my_function</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>42
&lt;function my_function at 0x7fe6c1691b80&gt;
</code></pre><p>Since a function is just an object like anything else in Python, you can pass one as an argument to another function. The <code>has_docstring()</code> function checks to see whether the function that is passed to it has a docstring or not. We could define these two functions, <code>no()</code> and <code>yes()</code>, and pass them as arguments to the <code>has_docstring()</code> function. Since the <code>no()</code> function doesn&rsquo;t have a docstring, the <code>has_docstring()</code> function returns <code>False</code>. Likewise, <code>has_docstring()</code> returns <code>True</code> for the <code>yes()</code> function.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">def</span> <span class="nf">has_docstring</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="s2">&#34;&#34;&#34;Check to see if the function `func` has a docstring.
</span><span class="s2">
</span><span class="s2">    Args:
</span><span class="s2">        func (callable): A function.
</span><span class="s2">
</span><span class="s2">    Returns:
</span><span class="s2">        bool
</span><span class="s2">    &#34;&#34;&#34;</span>
    <span class="k">return</span> <span class="n">func</span><span class="o">.</span><span class="vm">__doc__</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

<span class="k">def</span> <span class="nf">yes</span><span class="p">():</span>
    <span class="s2">&#34;&#34;&#34;Return the value 42
</span><span class="s2">    &#34;&#34;&#34;</span>
    <span class="k">return</span> <span class="mi">42</span>

<span class="k">def</span> <span class="nf">no</span><span class="p">():</span>
    <span class="k">return</span> <span class="mi">42</span>

<span class="nb">print</span><span class="p">(</span><span class="n">has_docstring</span><span class="p">(</span><span class="n">yes</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">has_docstring</span><span class="p">(</span><span class="n">no</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">has_docstring</span><span class="p">(</span><span class="n">has_docstring</span><span class="p">))</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>True
False
True
</code></pre><p>Functions can also be defined inside other functions. These kinds of functions are called <strong>nested functions</strong>. A nested function can make your code easier to read. In this example, if <code>x</code> and <code>y</code> are within some bounds, <code>foo()</code> prints <code>x</code> times <code>y</code>. We can make that if statement easier to read by defining an <code>in_range()</code> function.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">def</span> <span class="nf">foo1</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="o">&gt;</span><span class="mi">4</span> <span class="ow">and</span> <span class="n">x</span><span class="o">&lt;</span><span class="mi">10</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">y</span><span class="o">&gt;</span><span class="mi">4</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">&lt;</span><span class="mi">10</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">foo2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">in_range</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">v</span><span class="o">&gt;</span><span class="mi">4</span> <span class="ow">and</span> <span class="n">v</span><span class="o">&lt;</span><span class="mi">10</span>
    <span class="k">if</span> <span class="n">in_range</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">and</span> <span class="n">in_range</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">)</span>

<span class="n">foo1</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
<span class="n">foo2</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>30
56
</code></pre><p>Function also could return a function. For instance, the function <code>get_function()</code> creates a new function, <code>print_me()</code>, and then returns it. If we assign the result of calling <code>get_function()</code> to the variable &ldquo;<code>new_func</code>&rdquo;, we are assigning the return value, &ldquo;<code>print_me(</code>)&rdquo; to &ldquo;<code>new_func</code>&rdquo;. We can then call <code>new_</code>func()`` as if it were the <code>print_me()</code> function.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">def</span> <span class="nf">get_function</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">print_me</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">print_me</span>

<span class="n">new_func</span> <span class="o">=</span> <span class="n">get_function</span><span class="p">()</span>
<span class="n">new_func</span><span class="p">(</span><span class="s2">&#34;test&#34;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>test
</code></pre><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">def</span> <span class="nf">create_math_function</span><span class="p">(</span><span class="n">func_name</span><span class="p">):</span>
	<span class="k">if</span> <span class="n">func_name</span> <span class="o">==</span> <span class="s1">&#39;add&#39;</span><span class="p">:</span>
		<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
			<span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
		<span class="k">return</span> <span class="n">add</span>

	<span class="k">elif</span> <span class="n">func_name</span> <span class="o">==</span> <span class="s1">&#39;subtract&#39;</span><span class="p">:</span>
		<span class="k">def</span> <span class="nf">subtract</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
			<span class="k">return</span> <span class="n">a</span><span class="o">-</span><span class="n">b</span>
		<span class="k">return</span> <span class="n">subtract</span>
		
	<span class="k">else</span><span class="p">:</span>
		<span class="nb">print</span><span class="p">(</span><span class="s2">&#34;I don&#39;t know that one&#34;</span><span class="p">)</span>
    
<span class="n">add</span> <span class="o">=</span> <span class="n">create_math_function</span><span class="p">(</span><span class="s1">&#39;add&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;5 + 2 = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">add</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>

<span class="n">subtract</span> <span class="o">=</span> <span class="n">create_math_function</span><span class="p">(</span><span class="s1">&#39;subtract&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;5 - 2 = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">subtract</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>5 + 2 = 7
5 - 2 = 3
</code></pre><h2 id="scope">Scope</h2>
<p>We have discussed scope in python before, now we gonna briefly recall it. Python has to have strict rules about which variable you are referring to when using a particular variable name.</p>
<ol>
<li>First, the interpreter looks in the <strong>Local Scope</strong>. When you are inside a function, the local scope is made up of the arguments and any variables defined inside the function.</li>
<li>In the case of nested functions, where one function is defined inside another function, Python will check the scope of the parent function after checking the local scope. This is called the <strong>Nonlocal Scope</strong> to show that it is not the local scope of the child function and not the global scope.</li>
<li>If the interpreter can&rsquo;t find the variable in the (non)local scope, it expands its search to the <strong>Global Scope</strong>. These are the things defined outside the function.</li>
<li>Finally, if it can&rsquo;t find the thing it is looking for in the global scope, the interpreter checks the <strong>Builtin Scope</strong>. These are things that are always available in Python. For instance, the <code>print()</code> function is in the builtin scope, which is why we are able to use it in any scope.</li>
</ol>
<p><img src="https://raw.githubusercontent.com/floating15/img/main/202204071313549.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>Note that Python only gives you <strong>read</strong> access, instead of <strong>write</strong>, to variables defined outside of your current scope. But you can write it indirectly using <code>global</code> or <code>nonlocal</code> keywords.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="n">x</span> <span class="o">=</span> <span class="mi">50</span>

<span class="k">def</span> <span class="nf">one</span><span class="p">():</span>
  	<span class="n">x</span> <span class="o">=</span> <span class="mi">10</span>

<span class="k">def</span> <span class="nf">two</span><span class="p">():</span>
	<span class="k">global</span> <span class="n">x</span>
	<span class="n">x</span> <span class="o">=</span> <span class="mi">30</span>

<span class="k">def</span> <span class="nf">three</span><span class="p">():</span>
	<span class="n">x</span> <span class="o">=</span> <span class="mi">100</span>
	<span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="p">[</span><span class="n">one</span><span class="p">,</span> <span class="n">two</span><span class="p">,</span> <span class="n">three</span><span class="p">]:</span>
  	<span class="err">`</span><span class="n">func</span><span class="p">()</span><span class="err">`</span>
  	<span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>50
30
100
30
</code></pre><h2 id="closure">Closure</h2>
<p>A closure in Python is a tuple of variables that are no longer in scope, but that a function needs in order to run.</p>
<p>Consider an example. The function <code>foo()</code> defines a nested function <code>bar()</code> that prints the value of &ldquo;<code>a</code>&rdquo;. <code>foo()</code> returns this new function, so when we say &ldquo;<code>func = foo()</code>&rdquo; we are assigning the <code>bar()</code> function to the variable &ldquo;<code>func</code>&rdquo;. When we call <code>func()</code>, it prints the value of variable &ldquo;<code>a</code>&rdquo;, which is 5.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
    <span class="n">a</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="k">def</span> <span class="nf">bar</span><span class="p">():</span>  <span class="c1"># Notice, if you set `def bar(a):`, then you must assign it a value when you call bar().</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">bar</span>

<span class="n">func</span> <span class="o">=</span> <span class="n">foo</span><span class="p">()</span>
<span class="n">func</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>a
</code></pre><p>How does function &ldquo;<code>func()</code>&rdquo; know anything about variable &ldquo;<code>a</code>&rdquo;? &ldquo;<code>a</code>&rdquo; is defined in <code>foo()</code>&rsquo;s scope, not <code>bar()</code>&rsquo;s. You would think that &ldquo;<code>a</code>&rdquo; would not be observable outside of the scope of <code>foo()</code>. That&rsquo;s where closures come in. <strong>When <code>foo()</code> returned the new <code>bar()</code> function, Python helpfully attached any nonlocal variable that <code>bar()</code> was going to need to the function object</strong>.</p>
<p>Those variables get stored in a tuple in the &ldquo;<code>__closure__</code>&rdquo; attribute, which could be iterated, of the function. The closure for &ldquo;<code>func</code>&rdquo; has one variable, and you can view the value of that variable by accessing the &ldquo;<code>cell_contents</code>&rdquo; of the item.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="nb">print</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="vm">__closure__</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="vm">__closure__</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="vm">__closure__</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="vm">__closure__</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cell_contents</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>(&lt;cell at 0x7fe6b033aa30: int object at 0x7fe70002e9b0&gt;,)
&lt;class 'tuple'&gt;
1
5
</code></pre><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">def</span> <span class="nf">parent</span><span class="p">(</span><span class="n">arg_1</span><span class="p">,</span> <span class="n">arg_2</span><span class="p">):</span>
    <span class="n">value</span> <span class="o">=</span> <span class="mi">22</span>
    <span class="n">my_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;chocolate&#39;</span><span class="p">:</span> <span class="s1">&#39;yummy&#39;</span><span class="p">}</span>

    <span class="k">def</span> <span class="nf">child</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">value</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">my_dict</span><span class="p">[</span><span class="s1">&#39;chocolate&#39;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">arg_1</span> <span class="o">+</span> <span class="n">arg_2</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">child</span>

<span class="n">new_function</span> <span class="o">=</span> <span class="n">parent</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="nb">print</span><span class="p">([</span><span class="n">cell</span><span class="o">.</span><span class="n">cell_contents</span> <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">new_function</span><span class="o">.</span><span class="vm">__closure__</span><span class="p">])</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>[3, 4, {'chocolate': 'yummy'}, 22]
</code></pre><p>Let&rsquo;s examine this bit of code. Here, <code>x</code> is defined in the global scope. <code>foo()</code> creates a function <code>bar()</code> that prints whatever argument was passed to <code>foo()</code>. When we call <code>foo()</code> and assign the result to &ldquo;<code>my_func</code>&rdquo;, we pass in &ldquo;<code>x</code>&rdquo;. So, as expected, calling <code>my_func()</code> prints the value of <code>x</code>. Now let&rsquo;s delete <code>x</code> and call <code>my_func()</code> again, we would still print 25. That&rsquo;s because <code>foo()</code>&rsquo;s &ldquo;<code>value</code>&rdquo; argument gets added to the closure attached to the new &ldquo;<code>my_func</code>&rdquo; function. So even though <code>x</code> doesn&rsquo;t exist anymore, the value persists in its closure.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="n">x</span> <span class="o">=</span> <span class="mi">25</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">bar</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">bar</span>

<span class="n">my_func</span> <span class="o">=</span> <span class="n">foo</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="c1"># &lt;-- Create closure here</span>
<span class="n">my_func</span><span class="p">()</span>

<span class="k">del</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">my_func</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">my_func</span><span class="o">.</span><span class="vm">__closure__</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cell_contents</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="mi">52</span>
<span class="n">my_func</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">my_func</span><span class="o">.</span><span class="vm">__closure__</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cell_contents</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>25
25
25
25
25
</code></pre><p>Notice that nothing changes if we overwrite &ldquo;<code>x</code>&rdquo; instead of deleting it. Here we&rsquo;ve passed <code>x</code> into <code>foo()</code> and then assigned the new function to the variable <code>x</code>. The old value of &ldquo;<code>x</code>&rdquo;, 25, is still stored in the new function&rsquo;s closure, even though the new function is now stored in the &ldquo;<code>x</code>&rdquo; variable.</p>
<h2 id="decorators-1">Decorators</h2>
<p>Let&rsquo;s say you have a function that takes some inputs and returns some outputs. <strong>Decorators are just functions that take a function as an argument and return a modified version of that function that changes that function&rsquo;s behavior</strong>. You can modify the inputs, modify the outputs, or even change the behavior of the function itself.</p>
<p>To start off, let&rsquo;s define a function <code>double_args</code> does not modify anything of the input function.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">def</span> <span class="nf">double_args</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
	<span class="k">return</span> <span class="n">func</span>
</code></pre></td></tr></table>
</div>
</div><p>It just takes a function and immediately returns it. If we call this version of <code>double_args()</code> that does nothing and pass it the <code>multiply()</code> function and then assign the result to the variable &ldquo;<code>new_multiply</code>&rdquo;, then we can call <code>new_multiply(1, 5)</code> and get the same value we would have gotten from <code>multiply(1, 5)</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">def</span> <span class="nf">multiply</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
	<span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span>

<span class="k">def</span> <span class="nf">double_args</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
	<span class="k">return</span> <span class="n">func</span>

<span class="n">new_multiply</span> <span class="o">=</span> <span class="n">double_args</span><span class="p">(</span><span class="n">multiply</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">new_multiply</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="n">multiply</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>True
</code></pre><p><strong>In order for your decorator to return a modified function, it is usually helpful for it to define a nested function to return</strong>. We&rsquo;ll call that nested function &ldquo;<code>wrapper()</code>&rdquo;. All <code>wrapper()</code> does is take two arguments and passes them on to whatever function was passed to <code>double_args()</code> in the first place, assuming that the function passed to <code>double_args()</code> also takes exactly two arguments.</p>
<p>So, <code>double_args()</code> is still not doing anything to actually modify the function it is decorating. Once again, we&rsquo;ll pass <code>multiply()</code> to <code>double_args()</code> and assign the result to <code>new_multiply()</code>. If we then call <code>new_multiply()</code>, which is now equal to the <code>wrapper()</code> function, <code>wrapper()</code> calls <code>multiply()</code> because it is the function that was passed to <code>double_args()</code>. So <code>wrapper()</code> calls <code>multiply()</code> with the arguments 1 and 5, which returns 5.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">def</span> <span class="nf">double_args</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
	<span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
		<span class="k">return</span><span class="p">(</span><span class="n">func</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">))</span>
	<span class="k">return</span> <span class="n">wrapper</span>

<span class="n">new_multiply</span> <span class="o">=</span> <span class="n">double_args</span><span class="p">(</span><span class="n">multiply</span><span class="p">)</span> <span class="c1"># ==&gt; **refer** `wrapper` with 2 arguments `a`,`b` and a closure `multiply`.</span>
<span class="n">new_multiply</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span> <span class="c1"># ==&gt; **call** wrapper(1,5) return multiply(1,5)</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>5
</code></pre><p>Now let&rsquo;s actually modify the function our decorator is decorating. This time, <code>wrapper()</code> will still call whatever function is passed to <code>double_args()</code>, but it will double every argument when it calls the original function. As usual, we will call <code>double_args()</code> on the <code>multiply()</code> function and assign the result to <code>new_multiply</code>. Now, when we call <code>new_multiply()</code> with 1 and 5 as arguments, <code>new_multiply()</code> is equal to <code>wrapper()</code>, which calls <code>multiply()</code> after doubling each argument. So 1 becomes 2 and 5 becomes 10, giving us 2 times 10, which equals 20.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">def</span> <span class="nf">double_args</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
	<span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
		<span class="k">return</span><span class="p">(</span><span class="n">func</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">a</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">b</span><span class="p">))</span>
	<span class="k">return</span> <span class="n">wrapper</span>

<span class="n">new_multiply</span> <span class="o">=</span> <span class="n">double_args</span><span class="p">(</span><span class="n">multiply</span><span class="p">)</span> <span class="c1"># ==&gt; e.t. wrapper with closure `multiply`</span>
<span class="n">new_multiply</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span> <span class="c1"># ==&gt; e.t. `wrapper(1,5)` returns `multiply(2,10)`</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>20
</code></pre><p>This time, instead of assigning the new function to &ldquo;<code>new_multiply</code>&rdquo;, we&rsquo;re going to overwrite the &ldquo;<code>multiply</code>&rdquo; variable. And then calling <code>multiply()</code> with arguments 1 and 5 gives us 20 instead of 5. Remember that we can do this because <strong>Python stores the original multiply function in the new function&rsquo;s closure</strong>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="n">multiply</span> <span class="o">=</span> <span class="n">double_args</span><span class="p">(</span><span class="n">multiply</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">multiply</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">multiply</span><span class="o">.</span><span class="vm">__closure__</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cell_contents</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>20
&lt;function multiply at 0x7f0060c9e620&gt;
</code></pre><p>Now we can implement above code in a concise way, using <code>@</code> symbol followed by the decorator&rsquo;s name on the line directly above the function you are decorating.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">def</span> <span class="nf">double_args</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
	<span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
		<span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="n">b</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">wrapper</span>

<span class="nd">@double_args</span>
<span class="k">def</span> <span class="nf">multiply</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
	<span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span>

<span class="n">multiply</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>20
</code></pre><p>This is just a Python convenience for saying &ldquo;<code>multiply</code>&rdquo; equals the value returned by calling <code>double_args()</code> with &ldquo;<code>multiply</code>&rdquo; as the only argument, i.e. <code>multiply = double_args(multiply)</code>. The above code is exactly equivalent to the following code,</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">def</span> <span class="nf">double_args</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
	<span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
		<span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="n">b</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">wrapper</span>

<span class="k">def</span> <span class="nf">multiply</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
	<span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span>

<span class="n">multiply</span> <span class="o">=</span> <span class="n">double_args</span><span class="p">(</span><span class="n">multiply</span><span class="p">)</span>
<span class="n">multiply</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>20
</code></pre><h1 id="more-on-decorators">More on Decorators</h1>
<h2 id="real-world-examples">Real-world examples</h2>
<h3 id="count-time-cost">count time cost</h3>
<p>We will walk through some real-world decorators so that we can start to recognize common decorator patterns. The <code>timer()</code> decorator runs the decorated function and then prints how long it took for the function to run.</p>
<blockquote>
<p>you wind up adding some version of this to all of projects because it is a pretty easy way to figure out where your computational bottlenecks are.</p>
</blockquote>
<p>All decorators have fairly similar-looking docstrings because they all take and return a single function. Like most decorators, we&rsquo;ll start off by defining a <code>wrapper()</code> function. This is the function that the decorator will return. <code>wrapper()</code> takes any number of positional and keyword arguments so that it can be used to decorate any function. The first thing the new function will do is record the time that it was called with the <code>time()</code> function. Then <code>wrapper()</code> gets the result of calling the decorated function. We don&rsquo;t return that value yet though. After calling the decorated function, <code>wrapper()</code> checks the time again, and prints a message about how long it took to run the decorated function. Once we&rsquo;ve done that, we need to return the value that the decorated function calculated.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="kn">import</span> <span class="nn">time</span>

<span class="k">def</span> <span class="nf">timer</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
	<span class="s2">&#34;&#34;&#34;A decorator that prints how long a function took to run.
</span><span class="s2">
</span><span class="s2">	Args:
</span><span class="s2">		func (callable): The function being decorated.
</span><span class="s2">
</span><span class="s2">	Returns:
</span><span class="s2">		callable: The decorated function. 
</span><span class="s2">	&#34;&#34;&#34;</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;time cost: </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">start_time</span><span class="si">}</span><span class="s2">s&#34;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">return</span> <span class="n">wrapper</span>

<span class="nd">@timer</span>
<span class="k">def</span> <span class="nf">sleep_second</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;get up ~ &#34;</span><span class="p">)</span>

<span class="n">sleep_second</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>get up ~ 
time cost: 3.0057671070098877s
</code></pre><p>Alternatively, you can also modify it as</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">def</span> <span class="nf">timer</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
	<span class="s2">&#34;&#34;&#34;A decorator that prints how long a function took to run.
</span><span class="s2">
</span><span class="s2">	Args:
</span><span class="s2">		func (callable): The function being decorated.
</span><span class="s2">
</span><span class="s2">	Returns:
</span><span class="s2">		callable: The decorated function. 
</span><span class="s2">	&#34;&#34;&#34;</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
        <span class="n">cost</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">start_time</span>
        <span class="n">timecost</span><span class="p">[</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">]</span><span class="o">=</span><span class="n">cost</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">return</span> <span class="n">wrapper</span>

<span class="nd">@timer</span>
<span class="k">def</span> <span class="nf">sleep_second1</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;get up ~ &#34;</span><span class="p">)</span>
<span class="nd">@timer</span>
<span class="k">def</span> <span class="nf">sleep_second2</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;get up ~ &#34;</span><span class="p">)</span>
<span class="nd">@timer</span>
<span class="k">def</span> <span class="nf">sleep_second3</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;get up ~ &#34;</span><span class="p">)</span>

<span class="n">timecost</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">funcls</span> <span class="o">=</span> <span class="p">[</span><span class="n">sleep_second1</span><span class="p">,</span><span class="n">sleep_second2</span><span class="p">,</span><span class="n">sleep_second3</span><span class="p">]</span>
<span class="p">[</span><span class="n">f</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">.5</span><span class="p">,</span><span class="mf">2.5</span><span class="p">))</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">funcls</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">timecost</span><span class="p">)</span> <span class="c1"># &lt;-- Notice, we can accept the desired dict because dict is mutable object.  </span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>get up ~ 
get up ~ 
get up ~ 
{'sleep_second1': 0.689359188079834, 'sleep_second2': 1.0407230854034424, 'sleep_second3': 1.763228178024292}
</code></pre><h3 id="store-the-result">store the result</h3>
<p>Memoizing is the process of storing the results of a function so that the next time the function is called <strong>with the same arguments</strong>; you can just look up the answer.</p>
<p>We start by setting up a dictionary that will map arguments to results. Then, as usual, we create <code>wrapper()</code> to be the new decorated function that this decorator returns. When the new function gets called, we check to see whether we&rsquo;ve ever seen these arguments before. If we haven&rsquo;t, we send them to the decorated function and store the arguments and result in the  dictionary. The next time we call this function with those same arguments, the return value will already be in the dictionary, and we can return the value very quickly.</p>
<p>There are something deserve attentions:</p>
<ul>
<li>Fitstly, when we use <code>@</code> symbol, Python actions as <code>multiply = memoize(multiply)</code>, which means Python packages all objects required by <code>wrapper</code> function, include (original)<code>multiply</code> and <code>result_dict</code> , in to the <strong>closure</strong>.</li>
<li>Secondly, when we call <code>multiply(1,2,3,4,5)</code>, the <code>result_dict</code> will be written the arguments and result by Python. But notice that dict is mutable object, which means the <strong>closure</strong>&rsquo;s second element, <code>result_dict</code>, will be changed simultaneously.</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="kn">import</span> <span class="nn">time</span>

<span class="k">def</span> <span class="nf">memoize</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="s2">&#34;&#34;&#34;A decorator that stores the result of decorated 
</span><span class="s2">    function with specific arguments.
</span><span class="s2">    
</span><span class="s2">    Args:
</span><span class="s2">        func (callable): The function being decorated.
</span><span class="s2">    
</span><span class="s2">    Returns:
</span><span class="s2">        callable: The decorated function. 
</span><span class="s2">    &#34;&#34;&#34;</span>
    <span class="n">result_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">args</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">result_dict</span><span class="p">:</span>
            <span class="n">result_dict</span><span class="p">[</span><span class="n">args</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result_dict</span><span class="p">[</span><span class="n">args</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">wrapper</span>

<span class="nd">@memoize</span>    <span class="c1"># &lt;--- e.t. multiply = memoize(multiply)</span>
<span class="k">def</span> <span class="nf">multiply</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">*=</span> <span class="n">i</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;time cost: 3s&#34;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">j</span>

<span class="nb">print</span><span class="p">([</span><span class="n">cell</span><span class="o">.</span><span class="n">cell_contents</span> <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">multiply</span><span class="o">.</span><span class="vm">__closure__</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="n">multiply</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="nb">print</span><span class="p">([</span><span class="n">cell</span><span class="o">.</span><span class="n">cell_contents</span> <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">multiply</span><span class="o">.</span><span class="vm">__closure__</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="n">multiply</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="nb">print</span><span class="p">([</span><span class="n">cell</span><span class="o">.</span><span class="n">cell_contents</span> <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">multiply</span><span class="o">.</span><span class="vm">__closure__</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="n">multiply</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="nb">print</span><span class="p">([</span><span class="n">cell</span><span class="o">.</span><span class="n">cell_contents</span> <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">multiply</span><span class="o">.</span><span class="vm">__closure__</span><span class="p">])</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>[&lt;function multiply at 0x7fe6d00fe3a0&gt;, {}]
time cost: 3s
120
[&lt;function multiply at 0x7fe6d00fe3a0&gt;, {(1, 2, 3, 4, 5): 120}]
120
[&lt;function multiply at 0x7fe6d00fe3a0&gt;, {(1, 2, 3, 4, 5): 120}]
time cost: 3s
720
[&lt;function multiply at 0x7fe6d00fe3a0&gt;, {(1, 2, 3, 4, 5): 120, (1, 2, 3, 4, 5, 6): 720}]
</code></pre><blockquote>
<p>You should consider using a decorator when you want to <strong>add some common bit of code to multiple functions</strong>.</p>
</blockquote>
<h3 id="multi-decorators">multi decorators</h3>
<p>You can use <code>@</code> symbol folded to make multi decorators, like:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="nd">@decorator2</span>
<span class="nd">@decorator1</span> 
<span class="k">def</span> <span class="nf">func</span><span class="p">():</span>
	<span class="k">pass</span>
</code></pre></td></tr></table>
</div>
</div><p>Recall that when we use <code>@decorator</code>, what Python exactly does is <strong>overwrite</strong> the decorated function <code>func</code>, like <code>func = decorator(func)</code>, which assigns the child function of <code>decorator</code> with the closure containing origin <code>func</code> to new <code>func</code>. Homogeneously, multi decorators just do <strong>nestedly overwrite</strong> the decorated function with inner-to-outer order. For instance, if we use above codes, then <code>decorator1</code> overwrites <code>func</code> firstly, assigns child function with closure  to <code>func</code>; And then <code>decorator2</code> overwrites <code>func</code> again,  assigns child function with closure to <code>func</code>. There is an example:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">def</span> <span class="nf">decorator1</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="n">a1</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Get in decorator1&#34;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper1</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Get in wrapper1&#34;</span> <span class="p">,</span><span class="n">a1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wrapper1</span>

<span class="k">def</span> <span class="nf">decorator2</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="n">a2</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Get in decorator2&#34;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper2</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Get in wrapper2&#34;</span> <span class="p">,</span><span class="n">a2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wrapper2</span>

<span class="nd">@decorator1</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Ger in f&#34;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>Get in decorator1
</code></pre><p>Python implements <code>f = decorator1(f)</code>, thus print the &ldquo;Get in decorator1&rdquo;.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-PY" data-lang="PY"><span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="vm">__closure__</span><span class="p">)</span>
<span class="nb">print</span><span class="p">([</span><span class="n">cell</span><span class="o">.</span><span class="n">cell_contents</span> <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="vm">__closure__</span><span class="p">])</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>(&lt;cell at 0x7fe6c168c7f0: int object at 0x7fe70002e930&gt;, &lt;cell at 0x7fe6c168c2b0: function object at 0x7fe6d00fdee0&gt;)
[1, &lt;function f at 0x7fe6d00fdee0&gt;]
</code></pre><p>We can see the global object <code>f</code> and nonlocal object <code>a1</code> has been in closure of decorated <code>f</code>. Now call the multi decorators:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="nd">@decorator2</span>
<span class="nd">@decorator1</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Ger in f&#34;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="vm">__closure__</span><span class="p">)</span>
<span class="nb">print</span><span class="p">([</span><span class="n">cell</span><span class="o">.</span><span class="n">cell_contents</span> <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="vm">__closure__</span><span class="p">])</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>Get in decorator1
Get in decorator2
(&lt;cell at 0x7fe6e0242df0: int object at 0x7fe70002e950&gt;, &lt;cell at 0x7fe6e0242280: function object at 0x7fe7014f6160&gt;)
[2, &lt;function decorator1.&lt;locals&gt;.wrapper1 at 0x7fe7014f6160&gt;]
</code></pre><p>we can see Python implements <code>f = decorator1(f)</code> and <code>f = decorator2(f)</code> successively, and print the statement in corresponding order. Notice that the nonlocal object <code>a2</code> and decorated <code>f</code> (<code>wrapper1</code>) were written into the closure of final <code>f</code>. So where is the closure of <code>wrapper1</code> that we discussed? We can find them disassembling <code>&lt;function decorator1.&lt;locals&gt;.wrapper1 at 0x7fe7014f6160&gt;</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="vm">__closure__</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">cell_contents</span><span class="o">.</span><span class="vm">__closure__</span><span class="p">)</span>
<span class="nb">print</span><span class="p">([</span><span class="n">cell1</span><span class="o">.</span><span class="n">cell_contents</span> <span class="k">for</span> <span class="n">cell1</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="vm">__closure__</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">cell_contents</span><span class="o">.</span><span class="vm">__closure__</span><span class="p">])</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>(&lt;cell at 0x7fe7014f8af0: int object at 0x7fe70002e930&gt;, &lt;cell at 0x7fe7014f87c0: function object at 0x7fe7014f61f0&gt;)
[1, &lt;function f at 0x7fe7014f61f0&gt;]
</code></pre><blockquote>
<p><code>f.__closure__[1]</code> is a cell object, you should call <code>cell_contents</code> attribute to attain the content of it.</p>
</blockquote>
<p>Everything we discussed above happened before calling the double-decorated function <code>f</code>. Since <code>f</code> is a nested function, like <code>f=decorator2(decorator1(f))</code>, when we call <code>f()</code>, the inner function <code>wrapper2</code> will conduct firstly, and then <code>wrapper1</code> and finally original <code>f</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="n">f</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>Get in wrapper2 2
Get in wrapper1 1
Ger in f
</code></pre><h3 id="other-examples">other examples</h3>
<p><code>print_return_type()</code> will print out the type of the variable that gets returned from every call of any function it is decorating</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">def</span> <span class="nf">print_return_type</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
  	<span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    	<span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    	<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">() returned type </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
      		<span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    	<span class="p">))</span>
    	<span class="k">return</span> <span class="n">result</span>
  	<span class="k">return</span> <span class="n">wrapper</span>
  
<span class="nd">@print_return_type</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
  	<span class="k">return</span> <span class="n">value</span>
  
<span class="nb">print</span><span class="p">(</span><span class="n">foo</span><span class="p">(</span><span class="mi">42</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">foo</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">foo</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">}))</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>foo() returned type &lt;class 'int'&gt;
42
foo() returned type &lt;class 'list'&gt;
[1, 2, 3]
foo() returned type &lt;class 'dict'&gt;
{'a': 42}
</code></pre><p>Counting how many times some functions is called:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">def</span> <span class="nf">counter</span><span class="p">(</span><span class="n">func</span><span class="p">):</span> <span class="c1"># &lt;-- called when use `@`</span>
	<span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>  <span class="c1"># &lt;-- called everytime calling `foo()`</span>
		<span class="n">wrapper</span><span class="o">.</span><span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
		<span class="k">return</span> <span class="n">func</span><span class="p">()</span> <span class="c1"># &lt;-- Notice the parentheses, we need to implement the passed-in function and attain the outcome, instead of assigning it to something.</span>
	<span class="n">wrapper</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
	<span class="k">return</span> <span class="n">wrapper</span>

<span class="nd">@counter</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
  	<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;calling foo()&#39;</span><span class="p">)</span>
  
<span class="p">[</span><span class="n">foo</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;foo() was called </span><span class="si">{}</span><span class="s1"> times.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">foo</span><span class="o">.</span><span class="n">count</span><span class="p">))</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>calling foo()
calling foo()
calling foo()
calling foo()
calling foo()
foo() was called 5 times.
</code></pre><blockquote>
<p>You can define the <a class="link" href="https://www.tutorialspoint.com/What-are-Python-function-attributes"  target="_blank" rel="noopener"
    >attribute</a> for function object by <code>func.attr</code> or <code>setattr()</code>/<code>getattr()</code>. (<a class="link" href="https://sethdandridge.com/blog/assigning-attributes-to-python-functions"  target="_blank" rel="noopener"
    >more</a>)</p>
</blockquote>
<h2 id="metadata">Metadata</h2>
<p>One of the problems with decorators is that they obscure the decorated function&rsquo;s metadata. Here we have a function, <code>sleep_n_seconds()</code>, with a docstring that explains exactly what it does. We can access the metadata for the function, like its docstring, name and default arguments.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">def</span> <span class="nf">sleep_n_seconds</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="s2">&#34;&#34;&#34;Pause processing for n seconds.
</span><span class="s2">
</span><span class="s2">    Args:
</span><span class="s2">        n (int): The number of seconds to pause for.
</span><span class="s2">    &#34;&#34;&#34;</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">sleep_n_seconds</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sleep_n_seconds</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sleep_n_seconds</span><span class="o">.</span><span class="vm">__defaults__</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>Pause processing for n seconds.
    
    Args:
        n (int): The number of seconds to pause for.
    
sleep_n_seconds
(10,)
</code></pre><p>But if we decorate <code>sleep_n_seconds()</code> with the <code>timer()</code> decorator, when we try to print the docstring or default, we get nothing back. Furthermore, when we try to look up the function&rsquo;s name, Python tells us that <code>sleep_n_seconds()</code>&rsquo;s name is &ldquo;<code>wrapper</code>&rdquo;.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="kn">import</span> <span class="nn">time</span>

<span class="k">def</span> <span class="nf">timer</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">start_time</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">return</span> <span class="n">wrapper</span>

<span class="nd">@timer</span>
<span class="k">def</span> <span class="nf">sleep_n_seconds</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="s2">&#34;&#34;&#34;Pause processing for n seconds.
</span><span class="s2">
</span><span class="s2">    Args:
</span><span class="s2">        n (int): The number of seconds to pause for.
</span><span class="s2">    &#34;&#34;&#34;</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">sleep_n_seconds</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sleep_n_seconds</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sleep_n_seconds</span><span class="o">.</span><span class="vm">__defaults__</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>None
wrapper
None
</code></pre><p>Remember that when we write decorators, we almost always define a <strong>nested function</strong> to return. Because the decorator overwrites the <code>sleep_n_seconds()</code> function, when you ask for <code>sleep_n_seconds()</code>&rsquo;s docstring or name, you are actually referencing the nested function that was returned by the decorator. In this case, the nested function was called <code>wrapper()</code> and it didn&rsquo;t have a docstring. You can access to this function via the closure, like</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="nb">print</span><span class="p">(</span><span class="n">sleep_n_seconds</span><span class="o">.</span><span class="vm">__closure__</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cell_contents</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sleep_n_seconds</span><span class="o">.</span><span class="vm">__closure__</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cell_contents</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sleep_n_seconds</span><span class="o">.</span><span class="vm">__closure__</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cell_contents</span><span class="o">.</span><span class="vm">__defaults__</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>Pause processing for n seconds.

    Args:
        n (int): The number of seconds to pause for.
    
sleep_n_seconds
(10,)
</code></pre><p>But there is an easy way to get to it if you need it. The <code>wraps()</code> function from the <code>functools</code> module is a decorator that you use when defining a decorator. If you use it to decorate the <code>wrapper</code> function that your decorator returns, it will modify <code>wrapper()</code>&rsquo;s metadata to look like the function you are decorating. Notice that the <code>wraps()</code> decorator takes the function you are decorating as an argument, we will talked about decorators that take arguments in the next section.</p>
<p>If we use this updated version of the <code>timer()</code> decorator to decorate <code>sleep_n_seconds(</code>) and then try to print <code>sleep_n_seconds()</code>&rsquo;s metadata, Python gives you the metadata from the function being decorated rather than the metadata of the <code>wrapper()</code> function.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>

<span class="k">def</span> <span class="nf">timer</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">start_time</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">return</span> <span class="n">wrapper</span>

<span class="nd">@timer</span>
<span class="k">def</span> <span class="nf">sleep_n_seconds</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="s2">&#34;&#34;&#34;Pause processing for n seconds.
</span><span class="s2">
</span><span class="s2">    Args:
</span><span class="s2">        n (int): The number of seconds to pause for.
</span><span class="s2">    &#34;&#34;&#34;</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
	<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;sleep </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">s&#34;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">sleep_n_seconds</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sleep_n_seconds</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sleep_n_seconds</span><span class="o">.</span><span class="vm">__defaults__</span><span class="p">)</span> <span class="c1"># &lt;-- why???</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>Pause processing for n seconds.

    Args:
        n (int): The number of seconds to pause for.
    
sleep_n_seconds
None # &lt;-- why???
</code></pre><p>As an added bonus, using <code>wraps()</code> when creating your decorator also gives you easy access to the original undecorated function via the <code>__wrapped__</code> attribute, or <code>.__closure__[0].cell_content__</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="n">orgfuc</span> <span class="o">=</span> <span class="n">sleep_n_seconds</span><span class="o">.</span><span class="n">__wrapped__</span>
<span class="nb">print</span><span class="p">(</span><span class="n">orgfuc</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sleep_n_seconds</span><span class="o">.</span><span class="vm">__closure__</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cell_contents</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">orgfuc</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">orgfuc</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">orgfuc</span><span class="o">.</span><span class="vm">__defaults__</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>&lt;function sleep_n_seconds at 0x7fdc88b33af0&gt;
&lt;function sleep_n_seconds at 0x7fdc88b33af0&gt;
Pause processing for n seconds.

    Args:
        n (int): The number of seconds to pause for.
    
sleep_n_seconds
(10,)
</code></pre><p>Notice that <code>__wrapped__</code> attribute is a function object, thus you can call it directly.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="n">orgfuc</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>sleep 3s
</code></pre><h2 id="decorators-that-take-arguments">Decorators that take arguments</h2>
<p>To add arguments to our decorator, we need <strong>another level of function nesting</strong>.</p>
<p>Let&rsquo;s consider this <code>run_three_times()</code> decorator. If you use it to decorate a function, it will run that function three times.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">def</span> <span class="nf">run_three_times</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
	<span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
		<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
			<span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">wrapper</span>
</code></pre></td></tr></table>
</div>
</div><p>Let&rsquo;s think about what we would need to change if we wanted to write a <code>run_n_times()</code> decorator. A decorator is only supposed to take one argument - the function it is decorating. Also, when you use decorator syntax, you&rsquo;re not supposed to use the parentheses. To make <code>run_n_times()</code> work, <strong>we have to turn it into a function that returns a decorator, rather than a function that is a decorator</strong>.</p>
<p>So <code>run_n_times()</code> takes <code>n</code> as an argument, instead of <code>func</code>. Then, inside of <code>run_n_times()</code>, we&rsquo;ll define a new <code>decorator</code> function. This function takes &ldquo;<code>func</code>&rdquo; as an argument because it is the function that will be acting as our decorator. We start our new decorator with a nested <code>wrapper()</code> function, as usual. Finally, <code>run_n_times()</code> returns the <code>decorator()</code> function we just defined, then we can use that return value as a decorator.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">def</span> <span class="nf">run_n_times</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
	<span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
		<span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
			<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
				<span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">wrapper</span>
	<span class="k">return</span> <span class="n">decorator</span>

<span class="nd">@run_n_times</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">print_sum</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
	<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>4
4
4
4
</code></pre><p>Notice how when we decorate <code>print_sum()</code> with <code>run_n_times()</code>, we use parentheses after <code>@run_n_times</code>. This indicates that we are actually calling <code>run_n_times()</code> and decorating <code>print_sum()</code> with the result of that function call. Since <strong>the return value from <code>run_n_times()</code> is a decorator function, we can use it to decorate <code>print_sum()</code></strong>.</p>
<p>Now let&rsquo;s explain exactly how this works without using decorator syntax. Like before, we have a function, <code>run_n_times()</code> that returns a decorator function when you call it. If we call <code>run_n_times()</code> with the argument <code>3</code>, it will return a decorator. In fact, it returns the decorator just like <code>run_three_times</code> defined above. The argument <code>3</code> is in the closure of returned decorator:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="c1"># run_n_times(3) almost e.t. run_three_times</span>
<span class="nb">print</span><span class="p">([</span><span class="n">cell</span><span class="o">.</span><span class="n">cell_contents</span> <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">run_n_times</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="vm">__closure__</span><span class="p">])</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>[3]
</code></pre><p>We could decorate <code>print_sum()</code> with this returned new decorator using decorator syntax. Python makes it convenient to do both of those in a single step though. When we use decorator syntax, <strong>the thing that comes after the <code>@</code> symbol must be a reference to a decorator function.</strong> We can use the name of a specific decorator, or we can call a function that returns a decorator.</p>
<p>Notice that decorating a function almost is equivalent with overwriting it. Thus we can decorate an already has been defined function by overwriting like:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="nb">print</span> <span class="o">=</span> <span class="n">run_n_times</span><span class="p">(</span><span class="mi">5</span><span class="p">)(</span><span class="nb">print</span><span class="p">)</span> <span class="c1"># run_n_times(5) returns a decorator, and then the decorator overwrites `print` and assigns the result to `print`.</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&#34;hello&#34;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>hello
hello
hello
hello
hello
</code></pre><blockquote>
<p>Remember implement <code>del print</code> after test.</p>
</blockquote>
<p>There is another application:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">def</span> <span class="nf">html</span><span class="p">(</span><span class="n">open_tag</span><span class="p">,</span> <span class="n">close_tag</span><span class="p">):</span>
	<span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
		<span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
		<span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
		<span class="n">msg</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
			<span class="k">return</span> <span class="s1">&#39;</span><span class="si">{}{}{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">open_tag</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">close_tag</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">wrapper</span>
	<span class="k">return</span> <span class="n">decorator</span>

<span class="nd">@html</span><span class="p">(</span><span class="s2">&#34;&lt;b&gt;&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;/b&gt;&#34;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
  <span class="k">return</span> <span class="s1">&#39;Hello </span><span class="si">{}</span><span class="s1">!&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

<span class="nd">@html</span><span class="p">(</span><span class="s2">&#34;&lt;i&gt;&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;/i&gt;&#34;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">goodbye</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
  <span class="k">return</span> <span class="s1">&#39;Goodbye </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

<span class="nd">@html</span><span class="p">(</span><span class="s2">&#34;&lt;div&gt;&#34;</span><span class="p">,</span> <span class="s2">&#34;&lt;/div&gt;&#34;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hello_goodbye</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
  <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="si">{}</span><span class="se">\n</span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hello</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">goodbye</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
  
<span class="nb">print</span><span class="p">(</span><span class="n">hello_goodbye</span><span class="p">(</span><span class="s1">&#39;Alice&#39;</span><span class="p">))</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>&lt;div&gt;
&lt;b&gt;Hello Alice!&lt;/b&gt;
&lt;i&gt;Goodbye Alice.&lt;/i&gt;
&lt;/div&gt;
</code></pre><h2 id="other-real-world-examples">Other real world examples</h2>
<h3 id="timeout">timeout</h3>
<p>Let&rsquo;s imagine that we have some functions that occasionally either run for longer than we want them to or just hang and never return. It would be nice if we could add some kind of <code>timeout()</code> decorator to those functions that will raise an error if the function runs for longer than expected.</p>
<p>To create the <code>timeout()</code> decorator, we are going to use some functions from Python&rsquo;s <code>signal</code> module.</p>
<ul>
<li>The <code>signal.signal()</code> function tells Python, &ldquo;<em>When you see the signal whose number is signalnum, call the handler function</em>.&rdquo;. In this case, we tell Python to call <code>raise_timeout()</code> whenever it sees the alarm signal.</li>
<li>The <code>raise_timeout()</code> function raises a <code>TimeoutError</code> when it is called.</li>
<li>The <code>signal.alarm()</code> function lets us set an alarm for some number of seconds in the future. Passing <code>0</code> to the <code>alarm()</code> function cancels the alarm.</li>
<li><code>timeout()</code> is a function that returns a decorator. It just like a decorator factory. When you call <code>timeout()</code>, it cranks out a brand new decorator that times out in 5 seconds, or 20 seconds, or whatever value we pass as <code>n_seconds</code>.</li>
<li><code>wrapper()</code> sets an alarm for 5 seconds in the future. Then it calls the function being decorated. It wraps that call in a <code>try</code> block so that in a <code>finally</code> block we can cancel the alarm. This ensures that the alarm either rings or gets canceled. Remember, when the alarm rings, Python calls the <code>raise_timeout()</code> function.</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">signal</span>
<span class="kn">import</span> <span class="nn">functools</span>

<span class="k">def</span> <span class="nf">raise_timeout</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span> <span class="c1"># &lt;-- Notice the arguments, why???</span>
	<span class="k">raise</span> <span class="ne">TimeoutError</span><span class="p">(</span><span class="s2">&#34;you timeout&#34;</span><span class="p">)</span>

<span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span>
	<span class="n">signalnum</span><span class="o">=</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGALRM</span><span class="p">,</span> 
	<span class="n">handler</span><span class="o">=</span><span class="n">raise_timeout</span>
<span class="p">)</span>

<span class="k">def</span> <span class="nf">timeout</span><span class="p">(</span><span class="n">n_seconds</span><span class="p">):</span>
	<span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
		<span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span> 
		<span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
			<span class="n">signal</span><span class="o">.</span><span class="n">alarm</span><span class="p">(</span><span class="n">n_seconds</span><span class="p">)</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
			<span class="k">finally</span><span class="p">:</span>
				<span class="n">signal</span><span class="o">.</span><span class="n">alarm</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">wrapper</span>
	<span class="k">return</span> <span class="n">decorator</span>

<span class="nd">@timeout</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
	<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
	<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;foo!&#39;</span><span class="p">)</span> 

<span class="nd">@timeout</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> 
<span class="k">def</span> <span class="nf">bar</span><span class="p">():</span>
	<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
	<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;bar!&#39;</span><span class="p">)</span>

<span class="n">foo</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>---------------------------------------------------------------------------
TimeoutError                              Traceback (most recent call last)
/var/folders/p6/qtqch15n41v436lkcl5zb7g80000gn/T/ipykernel_38592/2588934869.py in &lt;module&gt;
     31         print('bar!')
     32 
---&gt; 33 foo()

/var/folders/p6/qtqch15n41v436lkcl5zb7g80000gn/T/ipykernel_38592/2588934869.py in wrapper(*args, **kwargs)
     15                         signal.alarm(n_seconds)
     16                         try:
---&gt; 17                                 return func(*args, **kwargs)
     18                         finally:
     19                                 signal.alarm(0)

/var/folders/p6/qtqch15n41v436lkcl5zb7g80000gn/T/ipykernel_38592/2588934869.py in foo()
     23 @timeout(3)
     24 def foo():
---&gt; 25         time.sleep(5)
     26         print('foo!')
     27 

/var/folders/p6/qtqch15n41v436lkcl5zb7g80000gn/T/ipykernel_38592/2588934869.py in raise_timeout(*args, **kwargs)
      2 
      3 def raise_timeout(*args, **kwargs):
----&gt; 4         raise TimeoutError(&quot;you timeout&quot;)
      5 
      6 signal.signal(

TimeoutError: you timeout
</code></pre><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="n">bar</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>bar!
</code></pre><p>Notice that <code>wrapper()</code> returns the result of calling <code>func()</code>, <code>decorator()</code> returns <code>wrapper</code>, and <code>timeout()</code> returns <code>decorator</code>. So when we call <code>foo()</code>, which has a 5-second timeout, it will timeout like before. But <code>bar()</code>, which has a 20-second timeout, prints its message in 10 seconds, so the alarm gets canceled.</p>
<h3 id="tag-your-functions">tag your functions</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">def</span> <span class="nf">tag</span><span class="p">(</span><span class="o">*</span><span class="n">tags</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
      <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">wrapper</span><span class="o">.</span><span class="n">tags</span> <span class="o">=</span> <span class="n">tags</span>
    <span class="k">return</span> <span class="n">wrapper</span>
  <span class="k">return</span> <span class="n">decorator</span>

<span class="nd">@tag</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;this is a tag&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
  <span class="k">pass</span>

<span class="nb">print</span><span class="p">(</span><span class="n">foo</span><span class="o">.</span><span class="n">tags</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>('test', 'this is a tag')
</code></pre><h3 id="check-the-return-type">Check the return type</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="k">def</span> <span class="nf">returns</span><span class="p">(</span><span class="n">return_type</span><span class="p">):</span>
  <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
      <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
      <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">==</span> <span class="n">return_type</span>
      <span class="k">return</span> <span class="n">result</span>
    <span class="k">return</span> <span class="n">wrapper</span>
  <span class="k">return</span> <span class="n">decorator</span>
  
<span class="nd">@returns</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">value</span>

<span class="k">try</span><span class="p">:</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">foo</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]))</span>
<span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
  <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;foo() did not return a dict!&#39;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>foo() did not return a dict!
</code></pre><p><code>assert &lt;condition&gt;</code> return an <code>AssertionError</code> if <code>&lt;condition&gt;</code> is <code>False</code>.</p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/object-oriented-programming/">Object Oriented Programming</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
        <link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css"integrity="sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn"crossorigin="anonymous"
            ><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js"integrity="sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8"crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js"integrity="sha384-vZTG03m&#43;2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl"crossorigin="anonymous"
                defer
                >
            </script><script>
    window.addEventListener("DOMContentLoaded", () => {
        renderMathInElement(document.querySelector(`.article-content`), {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true }
            ]
        });})
</script>
    
</article>

    

    

<aside class="related-contents--wrapper">
    <h2 class="section-title">Related contents</h2>
    <div class="related-contents">
        <div class="flex article-list--tile">
            
                
<article class="has-image">
    <a href="/p/object-oriented-programming-v-special-attributes-magic-methods/">
        
        
            <div class="article-image">
                
                    <img src="/head_img/oop_hi/oo4.png" loading="lazy" data-key="" data-hash="/head_img/oop_hi/oo4.png"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Object Oriented Programming V (Special Attributes &amp; Magic Methods)</h2>
        </div>
    </a>
</article>
            
                
<article class="has-image">
    <a href="/p/object-oriented-programming-iv-class/">
        
        
            <div class="article-image">
                
                    <img src="/head_img/oop_hi/oo5.png" loading="lazy" data-key="" data-hash="/head_img/oop_hi/oo5.png"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Object Oriented Programming IV (Class)</h2>
        </div>
    </a>
</article>
            
                
<article class="has-image">
    <a href="/p/object-oriented-programming-ii-iterators-comprehensions-generators/">
        
        
            <div class="article-image">
                
                    <img src="/head_img/oop_hi/oo2.png" loading="lazy" data-key="" data-hash="/head_img/oop_hi/oo2.png"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Object Oriented Programming II (Iterators, Comprehensions &amp; Generators)</h2>
        </div>
    </a>
</article>
            
                
<article class="has-image">
    <a href="/p/object-oriented-programming-i-function/">
        
        
            <div class="article-image">
                
                    <img src="/head_img/oop_hi/oo1.png" loading="lazy" data-key="" data-hash="/head_img/oop_hi/oo1.png"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Object Oriented Programming I (Function)</h2>
        </div>
    </a>
</article>
            
                
<article class="">
    <a href="/p/high-performance-python-v-big-data/">
        
        

        <div class="article-details">
            <h2 class="article-title">High-Performance Python V (Big Data)</h2>
        </div>
    </a>
</article>
            
        </div>
    </div>
</aside>

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2020 - 
        
        2022 Haoming Wang
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.11.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>

</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css"integrity="sha256-c0uckgykQ9v5k&#43;IqViZOZKc47Jn7KQil4/MP3ySA3F8="crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css"integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE="crossorigin="anonymous"
            >

            </main>
    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">Table of contents</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#intro">Intro</a>
      <ol>
        <li><a href="#docstrings">Docstrings</a></li>
        <li><a href="#dry--do-one-thing">DRY &amp; Do one thing</a></li>
        <li><a href="#pass-by-assignment">Pass by assignment</a></li>
      </ol>
    </li>
    <li><a href="#context-managers">Context Managers</a>
      <ol>
        <li><a href="#using-context-managers">Using context managers</a></li>
        <li><a href="#writing-context-managers">Writing context managers</a></li>
        <li><a href="#advanced-topics">Advanced topics</a>
          <ol>
            <li><a href="#nested-contexts">Nested contexts</a></li>
            <li><a href="#handling-errors">Handling errors</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#decorators">Decorators</a>
      <ol>
        <li><a href="#functions-are-objects">Functions are objects</a></li>
        <li><a href="#scope">Scope</a></li>
        <li><a href="#closure">Closure</a></li>
        <li><a href="#decorators-1">Decorators</a></li>
      </ol>
    </li>
    <li><a href="#more-on-decorators">More on Decorators</a>
      <ol>
        <li><a href="#real-world-examples">Real-world examples</a>
          <ol>
            <li><a href="#count-time-cost">count time cost</a></li>
            <li><a href="#store-the-result">store the result</a></li>
            <li><a href="#multi-decorators">multi decorators</a></li>
            <li><a href="#other-examples">other examples</a></li>
          </ol>
        </li>
        <li><a href="#metadata">Metadata</a></li>
        <li><a href="#decorators-that-take-arguments">Decorators that take arguments</a></li>
        <li><a href="#other-real-world-examples">Other real world examples</a>
          <ol>
            <li><a href="#timeout">timeout</a></li>
            <li><a href="#tag-your-functions">tag your functions</a></li>
            <li><a href="#check-the-return-type">Check the return type</a></li>
          </ol>
        </li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js"integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

<script
    src="https://cdn.jsdelivr.net/gh/zhixuan2333/gh-blog@v0.1.0/js/ribbon.min.js"
    integrity="sha384-UEK8ZiP3VgFNP8KnKMKDmd4pAUAOJ59Y2Jo3ED2Z5qKQf6HLHovMxq7Beb9CLPUe"
    crossorigin="anonymous"
    size="300"
    alpha="0.6"
    zindex="-1"
    defer
></script>


    </body>
</html>
